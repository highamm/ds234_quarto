<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>DATA / STAT 234 - 6&nbsp; Tidying with tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-basics.html" rel="next">
<link href="./14-workflow.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-tidyr.html">Data Wrangling</a></li><li class="breadcrumb-item"><a href="./04-tidyr.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidying with <code>tidyr</code></span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DATA / STAT 234</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus and Course Information</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">The Core</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Plotting with <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-comm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Communication with <code>Quarto</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow and Other Skills</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-tidyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidying with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Coding in Base <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-forcats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Factors with <code>forcats</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Ethics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-merging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merging with <code>dplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Special Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-lubridate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dates with <code>lubridate</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-stringr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text Data with <code>tidytext</code> and <code>stringr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Predictive Modeling with knn</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-connections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Connections to STAT 113, STAT 213, and CS 140</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction to SQL with <code>dbplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#what-is-tidy-data" id="toc-what-is-tidy-data" class="nav-link active" data-scroll-target="#what-is-tidy-data"><span class="header-section-number">6.1</span> What is Tidy Data?</a></li>
  <li>
<a href="#separate-and-unite-columns" id="toc-separate-and-unite-columns" class="nav-link" data-scroll-target="#separate-and-unite-columns"><span class="header-section-number">6.2</span> <code>separate()</code> and <code>unite()</code> Columns</a>
  <ul class="collapse">
<li><a href="#separate-a-column" id="toc-separate-a-column" class="nav-link" data-scroll-target="#separate-a-column"><span class="header-section-number">6.2.1</span> <code>separate()</code> a Column</a></li>
  <li><a href="#unite-columns" id="toc-unite-columns" class="nav-link" data-scroll-target="#unite-columns"><span class="header-section-number">6.2.2</span> <code>unite()</code> Columns</a></li>
  <li><a href="#column-names-and-rename" id="toc-column-names-and-rename" class="nav-link" data-scroll-target="#column-names-and-rename"><span class="header-section-number">6.2.3</span> Column Names and <code>rename()</code></a></li>
  </ul>
</li>
  <li>
<a href="#reshaping-with-pivot_" id="toc-reshaping-with-pivot_" class="nav-link" data-scroll-target="#reshaping-with-pivot_"><span class="header-section-number">6.3</span> Reshaping with <code>pivot_()</code></a>
  <ul class="collapse">
<li><a href="#pivot_longer-to-gather-columns" id="toc-pivot_longer-to-gather-columns" class="nav-link" data-scroll-target="#pivot_longer-to-gather-columns"><span class="header-section-number">6.3.1</span> <code>pivot_longer()</code> to Gather Columns</a></li>
  <li><a href="#pivot_wider-to-spread-to-multiple-columns" id="toc-pivot_wider-to-spread-to-multiple-columns" class="nav-link" data-scroll-target="#pivot_wider-to-spread-to-multiple-columns"><span class="header-section-number">6.3.2</span> <code>pivot_wider()</code> to Spread to Multiple Columns</a></li>
  </ul>
</li>
  <li>
<a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">6.4</span> Practice</a>
  <ul class="collapse">
<li><a href="#class-exercises" id="toc-class-exercises" class="nav-link" data-scroll-target="#class-exercises"><span class="header-section-number">6.4.1</span> Class Exercises</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">6.4.2</span> Your Turn</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-tidyr.html">Data Wrangling</a></li><li class="breadcrumb-item"><a href="./04-tidyr.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidying with <code>tidyr</code></span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="tidyr" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidying with <code>tidyr</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>Goals:</strong></p>
<ul>
<li><p>describe what it means for a data set to be <strong>tidy</strong>.</p></li>
<li><p>use <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> to transform a data set into tidy form.</p></li>
<li><p>use <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> to transform a data set into tidy form.</p></li>
<li><p>combine <code>tidyr</code> functions with <code>dplyr</code> and <code>ggplot2</code> functions to form a more complete workflow.</p></li>
</ul>
<p><strong>The Data</strong>: We will first use a polling data set that contains variables collected from a few different polls in July 2016 for the U.S. presidential election. The data set was scraped from RealClear politics <a href="https://www.realclearpolitics.com/epolls/latest_polls/president/" class="uri">https://www.realclearpolitics.com/epolls/latest_polls/president/</a> by Dr.&nbsp;Ramler. The variables are:</p>
<ul>
<li>
<code>Poll</code>, the name of the poll</li>
<li>
<code>Date</code>, the date range that the poll was conducted</li>
<li>
<code>Sample</code>, contains the sample size of the poll and whether the poll was of Likely Voters or Registered Voters</li>
<li>
<code>MoE</code>, the margin of error of the poll (recall this term from IntroStat)</li>
<li>
<code>Clinton (D)</code>, the percentage of people in the poll voting for Clinton</li>
<li>
<code>Trump (R)</code>, the percentage of people in the poll voting for Trump</li>
<li>
<code>Johnson (L)</code>, the percentage of people in the poll voting for Johnson</li>
<li>
<code>Steing (G)</code>, the percentage of people in the poll voting for Stein</li>
</ul>
<section id="what-is-tidy-data" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="what-is-tidy-data">
<span class="header-section-number">6.1</span> What is Tidy Data?</h2>
<p><code>R</code> usually (but not always) works best when your data is in tidy form. A tidy data set has a few characteristics.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You should already be quite familiar with tidy data because, up to this point, all of the data sets we have used in this class (and probably most of the data sets that you see in STAT 113 an all of the data sets that you may have seen in STAT 213) are tidy.</p>
</div>
</div>
<p>The definition of tidy data below is taken from <code>R for Data Science</code>:</p>
<ol type="1">
<li>every variable in the data set is stored in its own column</li>
<li>every case in the data set is stored in its own row</li>
<li>each value of a variable is stored in one cell</li>
<li>values in the data set should <strong>not</strong> contain units</li>
<li>there should not be any table headers or footnotes</li>
</ol>
<p>We will begin by focusing on the first characteristic: every variable in a the data set should be stored in its own column (and correspondingly, number 3: each value of a variable should be stored in one cell).</p>
</section><section id="separate-and-unite-columns" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="separate-and-unite-columns">
<span class="header-section-number">6.2</span> <code>separate()</code> and <code>unite()</code> Columns</h2>
<p>In a fresh .qmd file (File -&gt; New File -&gt; Quarto) that is in your Notes project, copy and paste the following code into an <code>R</code> chunk:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="va">polls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/rcp-polls.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="st">"--"</span><span class="op">)</span></span>
<span><span class="va">polls</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 8</span></span>
<span><span class="co">#&gt;   Poll             Date  Sample   MoE `Clinton (D)` `Trump (R)` `Johnson (L)`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth         7/14… 688 LV   3.7            45          43             5</span></span>
<span><span class="co">#&gt; 2 CNN/ORC          7/13… 872 RV   3.5            42          37            13</span></span>
<span><span class="co">#&gt; 3 ABC News/Wash P… 7/11… 816 RV   4              42          38             8</span></span>
<span><span class="co">#&gt; 4 NBC News/Wall S… 7/9 … 1000 …   3.1            41          35            11</span></span>
<span><span class="co">#&gt; 5 Economist/YouGov 7/9 … 932 RV   4.5            40          37             5</span></span>
<span><span class="co">#&gt; 6 Associated Pres… 7/7 … 837 RV  NA              40          36             6</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: `Stein (G)` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose that you wanted to know what the average sample size of the polls was. Using <code>dplyr</code> functions,</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>meansample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sample</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What warning do you get? Why?</p>
<p>You would get a similar warning (or sometimes an error) any time that you want to try to use <code>Sample</code> size in plotting or summaries. The issue is that the <code>Sample</code> column actually contains two variables so the data set is not tidy.</p>
<section id="separate-a-column" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="separate-a-column">
<span class="header-section-number">6.2.1</span> <code>separate()</code> a Column</h3>
<p>Let’s <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> the <code>Sample</code> column into <code>Sample_size</code> and <code>Sample_type</code>:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, </span>
<span>           sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 9</span></span>
<span><span class="co">#&gt;   Poll          Date  Sample_size Sample_type   MoE `Clinton (D)` `Trump (R)`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth      7/14… 688         LV            3.7            45          43</span></span>
<span><span class="co">#&gt; 2 CNN/ORC       7/13… 872         RV            3.5            42          37</span></span>
<span><span class="co">#&gt; 3 ABC News/Was… 7/11… 816         RV            4              42          38</span></span>
<span><span class="co">#&gt; 4 NBC News/Wal… 7/9 … 1000        RV            3.1            41          35</span></span>
<span><span class="co">#&gt; 5 Economist/Yo… 7/9 … 932         RV            4.5            40          37</span></span>
<span><span class="co">#&gt; 6 Associated P… 7/7 … 837         RV           NA              40          36</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: `Johnson (L)` &lt;dbl&gt;, `Stein (G)` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The arguments to <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> are fairly easy to learn:</p>
<ul>
<li><p><code>col</code> is the name of the column in the data set you want to separate.</p></li>
<li><p><code>into</code> is the name of the new columns. These could be anything you want, and are entered in as a vector (with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> to separate the names)</p></li>
<li><p><code>sep</code> is the character that you want to separate the column by. In this case, the sample size and sample type were separated by whitespace, so our <code>sep = " "</code>, white space.</p></li>
</ul>
<p>The <code>sep</code> argument is the newest piece of information here.</p>
<p>Note that even using <code>sep = ""</code> will produce an error (there is not a space now, so <code>R</code> doesn’t know what to separate by):</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, </span>
<span>           sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, we would like the <code>Date</code> column to be separated into a poll start date and a poll end date:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_sep</span> <span class="op">&lt;-</span> <span class="va">polls</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,</span>
<span>           sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="unite-columns" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="unite-columns">
<span class="header-section-number">6.2.2</span> <code>unite()</code> Columns</h3>
<p><code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> is the “opposite” of <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>: use it when one variable is stored across multiple columns, but each row still represents a single case. The need to use <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> is less common than <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>. In our current data set, there is no need to use it at all. But, for the sake of seeing an example, let’s separate the <code>Start</code> date into <code>month</code> and <code>day</code> and then use <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> to re-unite those columns:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_sillytest</span> <span class="op">&lt;-</span> <span class="va">polls_sep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Start</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start_month"</span>, <span class="st">"Start_day"</span><span class="op">)</span>, </span>
<span>           sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span><span class="va">polls_sillytest</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 10</span></span>
<span><span class="co">#&gt;   Poll     Start_month Start_day End   Sample   MoE `Clinton (D)` `Trump (R)`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth 7           14        7/16  688 LV   3.7            45          43</span></span>
<span><span class="co">#&gt; 2 CNN/ORC  7           13        7/16  872 RV   3.5            42          37</span></span>
<span><span class="co">#&gt; 3 ABC New… 7           11        7/14  816 RV   4              42          38</span></span>
<span><span class="co">#&gt; 4 NBC New… 7           9         7/13  1000 …   3.1            41          35</span></span>
<span><span class="co">#&gt; 5 Economi… 7           9         7/11  932 RV   4.5            40          37</span></span>
<span><span class="co">#&gt; 6 Associa… 7           7         7/11  837 RV  NA              40          36</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: `Johnson (L)` &lt;dbl&gt;, `Stein (G)` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This situation could occur in practice: for example, the date variable may be in multiple columns, one for month and one for day (and if there are multiple years, there could be a third for year). We would use <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> to combine these two columns into a single <code>Date</code>, called <code>New_start_date</code>:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_sillytest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="st">"New_start_date"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Start_month</span>, <span class="va">Start_day</span><span class="op">)</span>,</span>
<span>        sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 9</span></span>
<span><span class="co">#&gt;   Poll            New_start_date End   Sample   MoE `Clinton (D)` `Trump (R)`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;           &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth        7/14           7/16  688 LV   3.7            45          43</span></span>
<span><span class="co">#&gt; 2 CNN/ORC         7/13           7/16  872 RV   3.5            42          37</span></span>
<span><span class="co">#&gt; 3 ABC News/Wash … 7/11           7/14  816 RV   4              42          38</span></span>
<span><span class="co">#&gt; 4 NBC News/Wall … 7/9            7/13  1000 …   3.1            41          35</span></span>
<span><span class="co">#&gt; 5 Economist/YouG… 7/9            7/11  932 RV   4.5            40          37</span></span>
<span><span class="co">#&gt; 6 Associated Pre… 7/7            7/11  837 RV  NA              40          36</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: `Johnson (L)` &lt;dbl&gt;, `Stein (G)` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> just switches around the first two arguments of <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>. Argument 1 is now the name of the new column and Argument 2 is the names of columns in the data set that you want to combine.</p>
</div>
</div>
<p>We have also used the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function in <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>. While <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> is a very general <code>R</code> function and isn’t specific to tidy data, this is the first time that we’re seeing it in this course. <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> officially stands for concatenate, but, in simpler terms, <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> combines two or more “things”, separated by a comma.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 4 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A" "A" "D"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is useful if a function argument expects two or more “things”: for example, in <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code>, the <code>into</code> argument requires two column names for this example. Those column names must be specified by combining the names together with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</p>
</section><section id="column-names-and-rename" class="level3" data-number="6.2.3"><h3 data-number="6.2.3" class="anchored" data-anchor-id="column-names-and-rename">
<span class="header-section-number">6.2.3</span> Column Names and <code>rename()</code>
</h3>
<p>You might have noticed that the columns with percentage of votes for Clinton, Trump, etc. are surrounded by backticks ` ` when you print <code>polls</code> or <code>polls_sep</code>:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_sep</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 9</span></span>
<span><span class="co">#&gt;   Poll       Start End   Sample   MoE `Clinton (D)` `Trump (R)` `Johnson (L)`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth   7/14  7/16  688 LV   3.7            45          43             5</span></span>
<span><span class="co">#&gt; 2 CNN/ORC    7/13  7/16  872 RV   3.5            42          37            13</span></span>
<span><span class="co">#&gt; 3 ABC News/… 7/11  7/14  816 RV   4              42          38             8</span></span>
<span><span class="co">#&gt; 4 NBC News/… 7/9   7/13  1000 …   3.1            41          35            11</span></span>
<span><span class="co">#&gt; 5 Economist… 7/9   7/11  932 RV   4.5            40          37             5</span></span>
<span><span class="co">#&gt; 6 Associate… 7/7   7/11  837 RV  NA              40          36             6</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: `Stein (G)` &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This happens because the column names have a space in them (this also would occur if the columns started with a number or had odd special characters in them). Then, any time you want to reference a variable, you need the include the backticks:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_sep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>meanclinton <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">Clinton</span> <span class="op">(</span><span class="va">D</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">## throws an error</span></span>
<span><span class="va">polls_sep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>meanclinton <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">`Clinton (D)`</span><span class="op">)</span><span class="op">)</span> <span class="co">## backticks save the day!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Having variable names with spaces doesn’t technically violate any principle of tidy data, but it can be quite annoying. Always using backticks can be a huge pain. We can rename variables easily with <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>, which just takes a series of <code>new_name = old_name</code> arguments.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_new</span> <span class="op">&lt;-</span> <span class="va">polls_sep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Clinton_D <span class="op">=</span> <span class="va">`Clinton (D)`</span>, Trump_R <span class="op">=</span> <span class="va">`Trump (R)`</span>,</span>
<span>         Johnson_L <span class="op">=</span> <span class="va">`Johnson (L)`</span>, Stein_G <span class="op">=</span> <span class="va">`Stein (G)`</span><span class="op">)</span></span>
<span><span class="va">polls_new</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 9</span></span>
<span><span class="co">#&gt;   Poll           Start End   Sample   MoE Clinton_D Trump_R Johnson_L Stein_G</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth       7/14  7/16  688 LV   3.7        45      43         5       1</span></span>
<span><span class="co">#&gt; 2 CNN/ORC        7/13  7/16  872 RV   3.5        42      37        13       5</span></span>
<span><span class="co">#&gt; 3 ABC News/Wash… 7/11  7/14  816 RV   4          42      38         8       5</span></span>
<span><span class="co">#&gt; 4 NBC News/Wall… 7/9   7/13  1000 …   3.1        41      35        11       6</span></span>
<span><span class="co">#&gt; 5 Economist/You… 7/9   7/11  932 RV   4.5        40      37         5       2</span></span>
<span><span class="co">#&gt; 6 Associated Pr… 7/7   7/11  837 RV  NA          40      36         6       2</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> can also be very useful if you have variable names that are very long to type out.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> is actually from <code>dplyr</code>, not <code>tidyr</code>, but we did not have a need for it with any of the <code>dplyr</code> data sets.</p>
</div>
</div>
<p>In the following exercises, use the toy data set to practice with <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">toy_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>show <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bojack Horseman: Netflix"</span>,</span>
<span>                                  <span class="st">"VEEP: HBO"</span>,</span>
<span>                                  <span class="st">"American Vandal: Netflix"</span>,</span>
<span>                                  <span class="st">"Community: Peacock"</span><span class="op">)</span>,</span>
<span>                         seasons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1-6"</span>, <span class="st">"1-7"</span>, <span class="st">"1-2"</span>, <span class="st">"1-6"</span><span class="op">)</span>,</span>
<span>                         main_first <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bojack"</span>, <span class="st">"Selina"</span>, <span class="st">"Peter"</span>, <span class="st">"Jeff"</span><span class="op">)</span>,</span>
<span>                         main_last <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Horseman"</span>, <span class="st">"Meyer"</span>, <span class="st">"Molganado"</span>, <span class="st">"Winger"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">toy_df</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;   show                     seasons main_first main_last</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                    &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 Bojack Horseman: Netflix 1-6     Bojack     Horseman </span></span>
<span><span class="co">#&gt; 2 VEEP: HBO                1-7     Selina     Meyer    </span></span>
<span><span class="co">#&gt; 3 American Vandal: Netflix 1-2     Peter      Molganado</span></span>
<span><span class="co">#&gt; 4 Community: Peacock       1-6     Jeff       Winger</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Exercise 1</strong>. <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> the <code>show</code> variable into a column that has the TV show name and a column that has the name of the network.</p>
<p><strong>Exercise 2</strong>. <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> the <code>seasons</code> variable into a column that has the starting season and a column that has the ending season.</p>
<p><strong>Exercise 3</strong>. <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> the <code>main_first</code> and <code>main_last</code> columns into a new column that gives the full name of the main character, with their first and last names separated by a single space.</p>
</section></section><section id="reshaping-with-pivot_" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="reshaping-with-pivot_">
<span class="header-section-number">6.3</span> Reshaping with <code>pivot_()</code>
</h2>
<p>We will continue to use the polling data set to introduce the pivoting functions and data reshaping. To make sure that we are all working with the same data set, run the following line of code:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_clean</span> <span class="op">&lt;-</span> <span class="va">polls</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, </span>
<span>           sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,</span>
<span>           sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Clinton_D <span class="op">=</span> <span class="va">`Clinton (D)`</span>, Trump_R <span class="op">=</span> <span class="va">`Trump (R)`</span>,</span>
<span>         Johnson_L <span class="op">=</span> <span class="va">`Johnson (L)`</span>, Stein_G <span class="op">=</span> <span class="va">`Stein (G)`</span><span class="op">)</span></span>
<span><span class="va">polls_clean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data set <code>polls_clean</code> <strong>still</strong> isn’t tidy!! The <code>candidate</code> variable is spread out over 4 different columns and the values in each of these 4 columns actually represent 1 variable: poll percentage.</p>
<p>Thinking about data “tidyness” using the definitions above can sometimes be a little bit confusing. In practice, oftentimes we will usually realize that a data set is untidy when we go to do something that should be super simple but that something turns out to not be super simple at all when the data is in its current form.</p>
<p>For example, one thing we might want to do is to make a plot that has poll <code>Start</code> time on the x-axis, polling numbers on the y-axis, and has candidates represented by different colours. For this small data set, we might not see any trends through time, but you could imagine this graph would be quite useful if we had polling numbers through June, July, August, September, etc.</p>
<p>Take a moment to think about how you would make this graph in <code>ggplot2</code>: what is your x-axis variable? What variable are you specifying for the y-axis? For the colours?</p>
<p>A first attempt in making a graph would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> polls_clean, <span class="fu">aes</span>(<span class="at">x =</span> Start, <span class="at">y =</span> Clinton_D)) <span class="sc">+</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> ....??????????))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we’re stuck. It’s certainly not impossible to make the graph with the data in its current form (keep adding <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> and re-specifying the aesthetics, then manually specify colours, then manually specify a legend), but it’s definitely a huge pain.</p>
<p>This is where <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> can help! <a href="https://www.youtube.com/watch?v=8w3wmQAMoxQ" target="_blank">https://www.youtube.com/watch?v=8w3wmQAMoxQ</a></p>
<section id="pivot_longer-to-gather-columns" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="pivot_longer-to-gather-columns">
<span class="header-section-number">6.3.1</span> <code>pivot_longer()</code> to Gather Columns</h3>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> “pivots” the data set so that is has more rows (hence the “longer”) by collapsing multiple columns into two columns. One new column is a “key” column, which is the new variable containing the old data set’s column names. The second new column is a “value” column, which is the new variable containing the old data set’s values for each of the old data set’s column names. It’s easier to see this with an example. We know from our plotting exercise above that we’d really like a <code>candidate</code> variable to colour by and a <code>poll_percent</code> variable for the y-axis of our plot. So, we can use <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> to make these two columns:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_clean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Clinton_D</span>, <span class="va">Trump_R</span>, <span class="va">Johnson_L</span>, <span class="va">Stein_G</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"candidate"</span>, values_to <span class="op">=</span> <span class="st">"poll_percent"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 28 × 8</span></span>
<span><span class="co">#&gt;   Poll     Start End   Sample_size Sample_type   MoE candidate poll_percent</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Monmouth 7/14  7/16  688         LV            3.7 Clinton_D           45</span></span>
<span><span class="co">#&gt; 2 Monmouth 7/14  7/16  688         LV            3.7 Trump_R             43</span></span>
<span><span class="co">#&gt; 3 Monmouth 7/14  7/16  688         LV            3.7 Johnson_L            5</span></span>
<span><span class="co">#&gt; 4 Monmouth 7/14  7/16  688         LV            3.7 Stein_G              1</span></span>
<span><span class="co">#&gt; 5 CNN/ORC  7/13  7/16  872         RV            3.5 Clinton_D           42</span></span>
<span><span class="co">#&gt; 6 CNN/ORC  7/13  7/16  872         RV            3.5 Trump_R             37</span></span>
<span><span class="co">#&gt; # ℹ 22 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> has three important arguments:</p>
<ul>
<li>
<code>cols</code>, the names of the columns that you want to PIVOT!</li>
<li>
<code>names_to</code>, the name of the new variable that will have the old column names (anything you want it to be!)</li>
<li>
<code>values_to</code>, the name of the new variable that will have the old column values (anything you want it to be!)</li>
</ul>
<p>Now we can make our plot using <code>ggplot</code> functions. But don’t forget to give a name to our new “long” data set first!</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polls_long</span> <span class="op">&lt;-</span> <span class="va">polls_clean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Clinton_D</span>, <span class="va">Trump_R</span>, <span class="va">Johnson_L</span>, <span class="va">Stein_G</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"candidate"</span>, values_to <span class="op">=</span> <span class="st">"poll_percent"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ignore as.Date for now....we will get to dates later!</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polls_long</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Start</span>, <span class="st">"%m/%d"</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">poll_percent</span>,</span>
<span>           colour <span class="op">=</span> <span class="va">candidate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Poll Start Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="04-tidyr_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="pivot_wider-to-spread-to-multiple-columns" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="pivot_wider-to-spread-to-multiple-columns">
<span class="header-section-number">6.3.2</span> <code>pivot_wider()</code> to Spread to Multiple Columns</h3>
<p>The “opposite” of <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> is <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>. We need to use <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> when one case is actually spread across multiple rows. <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> has two main arguments:</p>
<ul>
<li>
<code>names_from</code>, the column in the old data set that will provide the names of the new columns and</li>
<li>
<code>values_from</code>, the column in the old data set that will provide the values that fill in the new columns</li>
</ul>
<p>One common use case of <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> is the creation of a contingency table from summarised data. For example, suppose that, from the STAT 113 survey data, we have</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stat113_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/stat113.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stat113_sum</span> <span class="op">&lt;-</span> <span class="va">stat113_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_students <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stat113_sum</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 3</span></span>
<span><span class="co">#&gt; # Groups:   Year [4]</span></span>
<span><span class="co">#&gt;   Year      Sex   n_students</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 FirstYear F             90</span></span>
<span><span class="co">#&gt; 2 FirstYear M             84</span></span>
<span><span class="co">#&gt; 3 Junior    F             15</span></span>
<span><span class="co">#&gt; 4 Junior    M             18</span></span>
<span><span class="co">#&gt; 5 Senior    F              3</span></span>
<span><span class="co">#&gt; 6 Senior    M             10</span></span>
<span><span class="co">#&gt; # ℹ 2 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want to make a two-way (contingency) table of the number of students that has <code>Sex</code> on the rows and <code>Year</code> on the columns. <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> can put the levels of the <code>Year</code> variable as new columns in the data frame:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stat113_sum</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">Year</span>, values_from <span class="op">=</span> <span class="va">n_students</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;   Sex   FirstYear Junior Senior Sophomore</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt;  &lt;int&gt;  &lt;int&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 F            90     15      3       100</span></span>
<span><span class="co">#&gt; 2 M            84     18     10        76</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will see more examples of <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> in the Exercises.</p>
<div class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tidy data isn’t necessarily always better: you might find cases where you need to “untidy” the data by using <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> or <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>. However, most functions in <code>R</code> (and in other languages) work best with tidy data.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are a few more topics to discuss in tidying data. We have not yet discussed the 4th or 5th characteristics of tidy data (cells should not contain units and there should be no headers or footers), but these are usually dealt with when we read in the data. Therefore, these issues will be covered when we discuss <code>readr</code>.</p>
</div>
</div>
<p><strong>Exercise 4</strong>. With the <code>stat113_df</code> data, construct a table showing the average GPA (without missing GPA values) for each <code>Sex</code>-<code>Sport</code> combination. Then, pivot the table so that the columns are the levels of <code>Sport</code> and the rows are the levels of <code>Sex</code>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hint (only if you get stuck)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To create the (unpivoted) table, you will need to use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, adding in an <code>na.rm = TRUE</code> argument to <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>.</p>
</div>
</div>
</div>
<p><strong>Exercise 5</strong>. Suppose that you have the following data set that has the number of deaths from a disease for various years in different locations.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">disease_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>                             year1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">400</span>, <span class="fl">31</span><span class="op">)</span>,</span>
<span>                             year2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">80</span>, <span class="fl">99</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                             year3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pivot the data set so that there is a single column that gives the year and a single column that gives the death count.</p>
</section></section><section id="practice" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="practice">
<span class="header-section-number">6.4</span> Practice</h2>
<section id="class-exercises" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="class-exercises">
<span class="header-section-number">6.4.1</span> Class Exercises</h3>
<p><strong>Class Exercise 1</strong>. Once you have a handle on data science terminology, it’s not too difficult to transfer what you’ve learned to a different language. For example, students in computer science might be more familiar with Python. Google something like “pivot from wide to long in python” to find help on achieving the equivalent of <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> in Python.</p>
<p><strong>Class Exercise 2</strong>. The <code>UBSprices2</code> data set contains information on prices of common commodities in cities throughout the world in the years 2003 and 2009. The three commodities in the data set are Rice (1 kg worth), Bread (1 kg worth), and a Big Mac <a href="https://media1.giphy.com/media/Fw5LicDKem6nC/source.gif" class="uri">https://media1.giphy.com/media/Fw5LicDKem6nC/source.gif</a>. Read in the data set and explain why, in its current form, the data is <strong>not</strong> tidy.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prices_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/UBSprices2.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Class Exercise 3</strong>. Construct a plot that allows you to see how the price of rice has changed in between 2003 and 2009 for each of the cities in the data set.</p>
<!-- Convert the data set to a tidier form so that there is a `year` variable and a `commodity` variable that has 3 values: `"bigmac"`, `"bread"`, and `"rice"`. __Hint__: At some point, you will need to separate the commodity from the year in, for example, bread2009. But, you'll notice this is different than our other uses of `separate()` because there is no "-" or " " or "/" to use as a separating character. Look at the help for `separate()` and scroll down to the `sep` argument to see if you can figure out this issue.  Convert your data set from the previous exercise so that `commodity` is split up into 3 variables: `bigmac` price, `rice` price and `bread` price. -->
<p><strong>Class Exercise 4</strong>. Construct a plot that allows you to see how the price of each of the three commodities has changed between 2003 and 2009 for the city of Amsterdam.</p>
<!-- In which data set would it be easiest to make a line plot with `year` on the x-axis and price of `rice` on the y-axis with lines for each `city`? In which data set would it be easiest to make a line chart with 3 lines, one for each type of commodity, for the city of Amsterdam? -->
<p><strong>New Data</strong>:</p>
<p>The <code>under5mortality.csv</code> file contains data on mortality for people under the age of 5 in countries around the world (mortality in deaths per 1000 people). The data come from <a href="https://www.gapminder.org/data/" class="uri">https://www.gapminder.org/data/</a>. The data set is <strong>extremely</strong> wide in its current form, having a column for each year in the data set. Read in the data set with</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mortality_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/under5mortality.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mortality_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 217</span></span>
<span><span class="co">#&gt;   `Under five mortality` `1800` `1801` `1802` `1803` `1804` `1805` `1806`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Abkhazia                  NA     NA     NA     NA     NA     NA     NA </span></span>
<span><span class="co">#&gt; 2 Afghanistan              469.   469.   469.   469.   469.   469.   470.</span></span>
<span><span class="co">#&gt; 3 Akrotiri and Dhekelia     NA     NA     NA     NA     NA     NA     NA </span></span>
<span><span class="co">#&gt; 4 Albania                  375.   375.   375.   375.   375.   375.   375.</span></span>
<span><span class="co">#&gt; 5 Algeria                  460.   460.   460.   460.   460.   460.   460.</span></span>
<span><span class="co">#&gt; 6 American Samoa            NA     NA     NA     NA     NA     NA     NA </span></span>
<span><span class="co">#&gt; # ℹ 209 more variables: `1807` &lt;dbl&gt;, `1808` &lt;dbl&gt;, `1809` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1810` &lt;dbl&gt;, `1811` &lt;dbl&gt;, `1812` &lt;dbl&gt;, `1813` &lt;dbl&gt;, `1814` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1815` &lt;dbl&gt;, `1816` &lt;dbl&gt;, `1817` &lt;dbl&gt;, `1818` &lt;dbl&gt;, `1819` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1820` &lt;dbl&gt;, `1821` &lt;dbl&gt;, `1822` &lt;dbl&gt;, `1823` &lt;dbl&gt;, `1824` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1825` &lt;dbl&gt;, `1826` &lt;dbl&gt;, `1827` &lt;dbl&gt;, `1828` &lt;dbl&gt;, `1829` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1830` &lt;dbl&gt;, `1831` &lt;dbl&gt;, `1832` &lt;dbl&gt;, `1833` &lt;dbl&gt;, `1834` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1835` &lt;dbl&gt;, `1836` &lt;dbl&gt;, `1837` &lt;dbl&gt;, `1838` &lt;dbl&gt;, `1839` &lt;dbl&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Class Exercise 5</strong>. Notice that there are 217 columns (at the top of the print out of the header, 217 is the second number). When we use <code>tidyr</code>, we aren’t going to want to type out <code>c(2, 3, 4, 5, .....)</code> all the way up to <code>217</code>! <code>R</code> has short-hand notation that we can use with <code>:</code>. For example, type in <code>4:9</code> in your console window. Use this notation to tidy the <code>mortality_df</code> data set.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You’ll need to add something to your <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> function to convert the variable <code>Year</code> to numeric. We haven’t talked too much about variable types yet so, after your <code>values_to = "Mortality"</code> statement, add <code>, names_transform = list(Year = as.numeric)</code>, making sure you have a second <code>)</code> to close the <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> function.</p>
</div>
</div>
<p><strong>Class Exercise 6</strong>. Construct a plot to look at the overall under 5 mortality trends for each country.</p>
<p><strong>Class Exercise 7</strong>. What is the overall trend in under 5 mortality? Does every single country follow this trend? What looks strange about the plot, specifically about the data collected before 1900?</p>
</section><section id="your-turn" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="your-turn">
<span class="header-section-number">6.4.2</span> Your Turn</h3>
<p>The MLB salary data set contains salaries on all 862 players in Major League Baseball in 2016. The data set was obtained from <a href="http://www.usatoday.com/sports/mlb/salaries/2016/player/all/" target="_blank">http://www.usatoday.com/sports/mlb/salaries/2016/player/all/</a></p>
<p><strong>Your Turn 1</strong>. Read in the data using the following code chunk and, with your group, write a sentence or two that explains why the data set is not tidy.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="va">baseball_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/mlb2016.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">baseball_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 7</span></span>
<span><span class="co">#&gt;   Name             Team  POS   Salary       Years      Total.Value Avg.Annual</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 Clayton Kershaw  LAD   SP    $ 33,000,000 7 (2014-2… $ 215,000,… $ 30,714,…</span></span>
<span><span class="co">#&gt; 2 Zack Greinke     ARI   SP    $ 31,799,030 6 (2016-2… $ 206,500,… $ 34,416,…</span></span>
<span><span class="co">#&gt; 3 David Price      BOS   SP    $ 30,000,000 7 (2016-2… $ 217,000,… $ 31,000,…</span></span>
<span><span class="co">#&gt; 4 Miguel Cabrera   DET   1B    $ 28,000,000 10 (2014-… $ 292,000,… $ 29,200,…</span></span>
<span><span class="co">#&gt; 5 Justin Verlander DET   SP    $ 28,000,000 7 (2013-1… $ 180,000,… $ 25,714,…</span></span>
<span><span class="co">#&gt; 6 Yoenis Cespedes  NYM   CF    $ 27,328,046 3 (2016-1… $ 75,000,0… $ 25,000,…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Your Turn 2</strong>. Tidy the data set just so that</p>
<ul>
<li>
<code>Duration</code> of the salary contract (currently given in the <code>Year</code> column) is in its own column</li>
<li>the year range (also currently given in the <code>Year</code> column) is split into a variable called <code>Start</code> and a variable called <code>End</code> year that give the start and end years of the contract. You can still have special characters for now (like <code>(</code> and <code>)</code>) in the start and end year.</li>
</ul>
<p><strong>Your Turn 3</strong>. You should have received a warning message. What does this message mean? See if you can figure it out by typing <code>View(baseball_df)</code> in your console window and scrolling down to some of the rows that the warning mentions: 48, 59, 60, etc. With your group, explain why that warning message was given.</p>
<p><strong>Your Turn 4</strong>. We won’t learn about <code><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number()</a></code> until <code>readr</code>, but the function is straightforward enough to mention here. It’s useful when you have extra characters in the values of a numeric variable (like a <code>$</code> or a <code>(</code>), but you just want to grab the actual number:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">baseball_df</span> <span class="op">&lt;-</span> <span class="va">baseball_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Salary <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">Salary</span><span class="op">)</span>,</span>
<span>         Total.Value <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">Total.Value</span><span class="op">)</span>,</span>
<span>         Avg.Annual <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">Avg.Annual</span><span class="op">)</span>,</span>
<span>         Start <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">Start</span><span class="op">)</span>,</span>
<span>         End <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">End</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the code above so that the parsing is saved to <code>baseball_df</code>.</p>
<p><strong>Your Turn 5</strong>. With a partner, brainstorm <strong>2</strong> different graphics you could construct to investigate how player <code>Salary</code> compares for players with different <code>POS</code>. Each of you should make 1 of the graphics you discussed. Then, state the reason why making that plot would not have worked before we tidied the data set.</p>
<p><strong>New Data</strong>: For the rest of the exercises, we will use salary data from the National Football League obtained from FiveThirtyEight that were originally obtained from <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2018/2018-04-09" target="_blank">Spotrac.com</a>.</p>
<p>The data set has the top 100 paid players for each year for each position from 2011 through 2018, broken down by player position. For those unfamiliar with American football, the positions in the data set are Quarterback, Running Back, Wide Receiver, Tight End, and Offensive Lineman for offense, Cornerback, Defensive Lineman, Linebacker, and Safety for Defense, and a separate category for Special Teams players that includes punters and kickers. You can review a summary of player positions <a href="https://i.pinimg.com/originals/56/32/87/56328741cb64cd59dafd200c9d06a301.png" target="_blank"> here</a>.</p>
<p>We are interested in how salaries compare for the top 100 players in each position and on how salaries have changed through time for each position.</p>
<p>Read in the data set with</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nfl_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/nfl_salary.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Your Turn 6</strong>. Explain why this data set is <strong>not</strong> in tidy form.</p>
<p><strong>Your Turn 7</strong>. Tidy the data set and give your tidied data set a new name.</p>
<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cuation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following exercises are a bit more challenging. Even though they are “Your Turn” exercises, we will discuss them a bit as a class as well.</p>
</div>
</div>
<!-- __Your Turn 8__. To your data set in the previous exercise, add a ranking variable that ranks the salaries within each player position so that the highest paid players in each `year-position` combination all receive a `1`, the second highest paid players receive a `2`, etc. Compare your results for the default way that `R` uses to break ties between two salaries that are the same and using `ties.method = "first"`.  -->
<p><strong>Your Turn 8</strong>. Construct a graph that lets you explore how the maximum salary for each position has changed over time.</p>
<!-- Find the maximum salary for each player position in each year. Then, create two different line graphs that shows how the maximum salary has changed from 2011 to 2018 for each position. For one line graph, make the colours of the lines different for each position. For the second line graph, facet by position. Which graph do you like better? -->
<p><strong>Your Turn 9</strong>. What is one flaw about using the maximum salary for each position as our metric for “change” over time. What other metric might we use instead? Re-construct the graph with this other metric?</p>
<!-- Make the same graph, but plot the average salary of the top 20 players in each position of each year. What do you notice? Any interesting patterns for any of the positions? If you're a fan of football, provide a guess as to why one of the positions has had their salary plateau in recent years. -->
<p><strong>Your Turn 11</strong>. Sometimes for graphs involving cost or salary, we want to take into account the inflation rate. Google what the inflation rate was between 2011 and 2018 (Google something like “inflation rate from 2011 to 2018” and you should be able to find something). Adjust all of the 2011 salaries for inflation so that they are comparable to the 2018 salaries.</p>
<p><strong>Your Turn 12</strong>. Construct a graph that shows the salary depreciation from top paid players in each position to lesser paid players in each position for the year 2018 only. Which position has the largest depreciation?</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./14-workflow.html" class="pagination-link" aria-label="Workflow and Other Skills">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow and Other Skills</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-basics.html" class="pagination-link" aria-label="Coding in Base `R`">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Coding in Base <code>R</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Course Materials were written by Matt Higham for STAT/DATA 234 at St.&nbsp;Lawrence University.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>