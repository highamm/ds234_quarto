<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>DATA / STAT 234 - 13&nbsp; Text Data with tidytext and stringr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-knn.html" rel="next">
<link href="./11-lubridate.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-lubridate.html">Special Topics</a></li><li class="breadcrumb-item"><a href="./12-stringr.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text Data with <code>tidytext</code> and <code>stringr</code></span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DATA / STAT 234</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus and Course Information</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">The Core</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Plotting with <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-comm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Communication with <code>Quarto</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow and Other Skills</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidying with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Coding in Base <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-forcats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Factors with <code>forcats</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Ethics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-merging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merging with <code>dplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Special Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-lubridate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dates with <code>lubridate</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-stringr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text Data with <code>tidytext</code> and <code>stringr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Predictive Modeling with knn</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-connections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Connections to STAT 113, STAT 213, and CS 140</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction to SQL with <code>dbplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#text-analysis" id="toc-text-analysis" class="nav-link active" data-scroll-target="#text-analysis"><span class="header-section-number">13.1</span> Text Analysis</a></li>
  <li>
<a href="#introduction-to-stringr" id="toc-introduction-to-stringr" class="nav-link" data-scroll-target="#introduction-to-stringr"><span class="header-section-number">13.2</span> Introduction to <code>stringr</code></a>
  <ul class="collapse">
<li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions"><span class="header-section-number">13.2.1</span> Regular Expressions</a></li>
  <li><a href="#stringr-functions-with-dplyr" id="toc-stringr-functions-with-dplyr" class="nav-link" data-scroll-target="#stringr-functions-with-dplyr"><span class="header-section-number">13.2.2</span> <code>stringr</code> Functions with <code>dplyr</code></a></li>
  </ul>
</li>
  <li>
<a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">13.3</span> Practice</a>
  <ul class="collapse">
<li><a href="#class-exercises" id="toc-class-exercises" class="nav-link" data-scroll-target="#class-exercises"><span class="header-section-number">13.3.1</span> Class Exercises</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">13.3.2</span> Your Turn</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-lubridate.html">Special Topics</a></li><li class="breadcrumb-item"><a href="./12-stringr.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text Data with <code>tidytext</code> and <code>stringr</code></span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="text" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text Data with <code>tidytext</code> and <code>stringr</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>Goals</strong>:</p>
<ul>
<li>use functions in the <code>stringr</code> package and in the <code>tidytext</code> package to analyze text data.</li>
<li>introduce some of the issues with manipulating strings that don’t pertain to numeric or factor data.</li>
<li>perform a basic sentiment analysis.</li>
</ul>
<section id="text-analysis" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="text-analysis">
<span class="header-section-number">13.1</span> Text Analysis</h2>
<p>Beyonce is a legend. For this example, we will work through a text analysis on lyrics from songs from Beyonce’s albums, utilizing functions from both <code>stringr</code> to parse strings and <code>tidytext</code> to convert text data into a tidy format. To begin, read in a data set of Beyonce’s lyrics:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="va">beyonce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/beyonce_lyrics.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">beyonce</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will be most focused on the <code>line</code> variable, as each value for this variable contains a line from a Beyonce song. There’s other variables present as well, such as the <code>song_name</code> and the <code>artist_name</code> (the data set originally came from a data set with artists other than Beyonce).</p>
<p>You can look at the first 4 values of <code>line</code> with</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beyonce</span><span class="op">$</span><span class="va">line</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "If I ain't got nothing, I got you"                       </span></span>
<span><span class="co">#&gt; [2] "If I ain't got something, I don't give a damn"           </span></span>
<span><span class="co">#&gt; [3] "'Cause I got it with you"                                </span></span>
<span><span class="co">#&gt; [4] "I don't know much about algebra, but I know 1+1 equals 2"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our end goal is to construct a plot that shows the most popular words in Beyonce’s albums. This is much more challenging than it sounds because we will have to deal with the nuances of working with text data.</p>
<p>The <code>tidytext</code> package makes it a lot easier to work with text data in many regards. Let’s use the <code><a href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html">unnest_tokens()</a></code> functions from <code>tidytext</code> to separate the lines into individual words. We’ll name this new data set <code>beyonce_unnest</code>:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://juliasilge.github.io/tidytext/">tidytext</a></span><span class="op">)</span></span>
<span><span class="va">beyonce_unnest</span> <span class="op">&lt;-</span> <span class="va">beyonce</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"word"</span>, input <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span></span>
<span><span class="va">beyonce_unnest</span></span>
<span><span class="co">#&gt; # A tibble: 164,740 × 6</span></span>
<span><span class="co">#&gt;   song_id song_name artist_id artist_name song_line word   </span></span>
<span><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1   50396 1+1             498 Beyoncé             1 if     </span></span>
<span><span class="co">#&gt; 2   50396 1+1             498 Beyoncé             1 i      </span></span>
<span><span class="co">#&gt; 3   50396 1+1             498 Beyoncé             1 ain't  </span></span>
<span><span class="co">#&gt; 4   50396 1+1             498 Beyoncé             1 got    </span></span>
<span><span class="co">#&gt; 5   50396 1+1             498 Beyoncé             1 nothing</span></span>
<span><span class="co">#&gt; 6   50396 1+1             498 Beyoncé             1 i      </span></span>
<span><span class="co">#&gt; # ℹ 164,734 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll want to make sure that either all words are capitalized or no words are capitalized, for consistency (remember that <code>R</code> is case-sensitive). To that end, we’ll modify the <code>word</code> variable and use <code>stringr</code>’s <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower()</a></code> to change all letters to lower-case:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beyonce_unnest</span> <span class="op">&lt;-</span> <span class="va">beyonce_unnest</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try counting up Beyonce’s most popular words from the data set we just made:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beyonce_unnest</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6,469 × 2</span></span>
<span><span class="co">#&gt;   word      n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 you    7693</span></span>
<span><span class="co">#&gt; 2 i      6669</span></span>
<span><span class="co">#&gt; 3 the    4719</span></span>
<span><span class="co">#&gt; 4 me     3774</span></span>
<span><span class="co">#&gt; 5 to     3070</span></span>
<span><span class="co">#&gt; 6 it     2999</span></span>
<span><span class="co">#&gt; # ℹ 6,463 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What’s the issue here?</p>
<p>To remedy this, we can use what are called <strong>stop words</strong>: words that are very common and carry little to no meaningful information. For example <em>the</em>, <em>it</em>, <em>are</em>, etc. are all <strong>stop words</strong>. We need to eliminate these from the data set before we continue on. Luckily, the <code>tidytext</code> package also provides a data set of common stop words in a data set named <code>stop_words</code>:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">stop_words</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   word      lexicon</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 a         SMART  </span></span>
<span><span class="co">#&gt; 2 a's       SMART  </span></span>
<span><span class="co">#&gt; 3 able      SMART  </span></span>
<span><span class="co">#&gt; 4 about     SMART  </span></span>
<span><span class="co">#&gt; 5 above     SMART  </span></span>
<span><span class="co">#&gt; 6 according SMART</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s join the Beyonce lyrics data set to the stop words data set and elminate any stop words:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beyonce_stop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">beyonce_unnest</span>, <span class="va">stop_words</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">word</span> <span class="op">==</span> <span class="va">word</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can re-make the table with the stop words removed:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beyonce_sum</span> <span class="op">&lt;-</span> <span class="va">beyonce_stop</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5,937 × 2</span></span>
<span><span class="co">#&gt;    word        n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 love     1362</span></span>
<span><span class="co">#&gt;  2 baby     1024</span></span>
<span><span class="co">#&gt;  3 girl      592</span></span>
<span><span class="co">#&gt;  4 wanna     564</span></span>
<span><span class="co">#&gt;  5 hey       499</span></span>
<span><span class="co">#&gt;  6 boy       494</span></span>
<span><span class="co">#&gt;  7 yeah      491</span></span>
<span><span class="co">#&gt;  8 feel      488</span></span>
<span><span class="co">#&gt;  9 time      452</span></span>
<span><span class="co">#&gt; 10 uh        408</span></span>
<span><span class="co">#&gt; 11 halo      383</span></span>
<span><span class="co">#&gt; 12 check     366</span></span>
<span><span class="co">#&gt; 13 tonight   342</span></span>
<span><span class="co">#&gt; 14 girls     341</span></span>
<span><span class="co">#&gt; 15 ya        327</span></span>
<span><span class="co">#&gt; 16 run       325</span></span>
<span><span class="co">#&gt; 17 crazy     308</span></span>
<span><span class="co">#&gt; 18 world     301</span></span>
<span><span class="co">#&gt; 19 body      287</span></span>
<span><span class="co">#&gt; 20 ooh       281</span></span>
<span><span class="co">#&gt; 21 ladies    269</span></span>
<span><span class="co">#&gt; 22 top       241</span></span>
<span><span class="co">#&gt; 23 gotta     240</span></span>
<span><span class="co">#&gt; 24 beyoncé   238</span></span>
<span><span class="co">#&gt; 25 night     213</span></span>
<span><span class="co">#&gt; # ℹ 5,912 more rows</span></span>
<span><span class="va">beyonce_sum</span></span>
<span><span class="co">#&gt; # A tibble: 5,937 × 2</span></span>
<span><span class="co">#&gt;   word      n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 love   1362</span></span>
<span><span class="co">#&gt; 2 baby   1024</span></span>
<span><span class="co">#&gt; 3 girl    592</span></span>
<span><span class="co">#&gt; 4 wanna   564</span></span>
<span><span class="co">#&gt; 5 hey     499</span></span>
<span><span class="co">#&gt; 6 boy     494</span></span>
<span><span class="co">#&gt; # ℹ 5,931 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking through the list, there are <strong>still</strong> some stop words in there that were not picked up on in the <code>stop_words</code> data set.</p>
<p><strong>Exercise 1</strong>. Look at the remaining words. Do any of them look like stop words that were missed with the stop words from the <code>tidytext</code> package? Create a tibble with a few of the remaining stop words (like <code>ooh</code>, <code>gotta</code>, <code>ya</code>, <code>uh</code>, and <code>yeah</code>) not picked up by the <code>tidytext</code> package, and use a join function to drop these words from the data set.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hint (only if you get stuck)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The join function you will need to use here is <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>.</p>
</div>
</div>
</div>
<p><strong>Exercise 2</strong>. With the new data set, construct a lollipop plot or a bar plot that shows the 20 most common words Beyonce uses, as well as the number of times each word is used.</p>
<p><strong>Exercise 3</strong>. Use the <code><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html">wordcloud()</a></code> function in the <code>wordcloud</code> library and the code below to make a wordcloud of Beyonce’s words.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## install.packages("wordcloud")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://blog.fellstat.com/?cat=11">wordcloud</a></span><span class="op">)</span></span>
<span><span class="va">beyonce_small</span> <span class="op">&lt;-</span> <span class="va">beyonce_sum</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html">wordcloud</a></span><span class="op">(</span><span class="va">beyonce_small</span><span class="op">$</span><span class="va">word</span>, <span class="va">beyonce_small</span><span class="op">$</span><span class="va">n</span>, </span>
<span>          colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"Dark2"</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">.2</span><span class="op">)</span>,</span>
<span>          random.order <span class="op">=</span> <span class="cn">FALSE</span>, random.color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is not anything else you need to do for this exercise: just make the word cloud!</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to delve into text data more, you’ll need to learn about <em>regular expressions</em> , or <em>regexes</em>. If interested, you can read more in the <a href="https://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions" target="_blank">R4DS textbook</a>. Starting out is not too bad, but learning about escaping special characters in <code>R</code> can be much more challenging!</p>
</div>
</div>
<p>We analyzed a short text data set, but, you can imagine extending this type of analysis to things like:</p>
<ul>
<li>song lyrics, if you have the lyrics to all of the songs from an artist <a href="https://rpubs.com/RosieB/taylorswiftlyricanalysis" class="uri">https://rpubs.com/RosieB/taylorswiftlyricanalysis</a>
</li>
<li>book analysis, if you have the text of an entire book or series of books</li>
<li>tv analysis, if you have the scripts to all episodes of a tv show</li>
</ul>
<p>If you were doing one of these analyses, there are lots of cool functions in <code>tidytext</code> to help you out!</p>
<!-- see below: sentiment analysis for the friends package -->
<!-- https://amirdjv.netlify.app/post/rating-and-sentiment-analysis-for-friends/ -->
<!-- additional resource: https://www.tidytextmining.com/tidytext.html -->
</section><section id="introduction-to-stringr" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="introduction-to-stringr">
<span class="header-section-number">13.2</span> Introduction to <code>stringr</code>
</h2>
<p>In the previous examples, the string data that we had consisted primarily of <strong>words</strong>. The tools in <code>tidytext</code> make working with data consisting of words not too painful. However, some data exists as strings that are <strong>not</strong> words. For a non-trivial example, consider data sets obtained from <a href="https://github.com/JeffSackmann/tennis_MatchChartingProject" class="uri">https://github.com/JeffSackmann/tennis_MatchChartingProject</a>, a repository for professional tennis match charting put together by Jeff Sackmann. Some of the following code was modified from a project completed by a now-graduated student, James Wolpe.</p>
<p>From this repository, I have put together a data set on one particular tennis match to make it a bit easier for us to get started. The match I have chosen is the 2021 U.S. Open Final between Daniil Medvedev and Novak Djokovic. Why this match? This was arguably the most important match of Djokovic’s career: if he won, he would win all four grand slams in a calendar year. I don’t like Djokovic and he lost so looking back at the match brings me joy. Read in the data set with:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">med_djok_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/med_djok.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">med_djok_df</span></span>
<span><span class="co">#&gt; # A tibble: 182 × 46</span></span>
<span><span class="co">#&gt;   point      Serving match_id    Pt  Set1  Set2   Gm1   Gm2 Pts   `Gm#` TbSet</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 4f2d@      ND      2021091…     1     0     0     0     0 0-0   1 (1)     1</span></span>
<span><span class="co">#&gt; 2 6d         ND      2021091…     2     0     0     0     0 15-0  1 (2)     1</span></span>
<span><span class="co">#&gt; 3 6b29f3b3b… ND      2021091…     3     0     0     0     0 15-15 1 (3)     1</span></span>
<span><span class="co">#&gt; 4 4b28f1f2f… ND      2021091…     4     0     0     0     0 30-15 1 (4)     1</span></span>
<span><span class="co">#&gt; 5 5b37b3b3b… ND      2021091…     5     0     0     0     0 40-15 1 (5)     1</span></span>
<span><span class="co">#&gt; 6 6f28f1f1f… ND      2021091…     6     0     0     0     0 40-30 1 (6)     1</span></span>
<span><span class="co">#&gt; # ℹ 176 more rows</span></span>
<span><span class="co">#&gt; # ℹ 35 more variables: `TB?` &lt;dbl&gt;, TBpt &lt;lgl&gt;, Svr &lt;dbl&gt;, Ret &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1st` &lt;chr&gt;, `2nd` &lt;chr&gt;, Notes &lt;chr&gt;, `1stSV` &lt;dbl&gt;, `2ndSV` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1stIn` &lt;dbl&gt;, `2ndIn` &lt;dbl&gt;, isAce &lt;lgl&gt;, isUnret &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   isRallyWinner &lt;lgl&gt;, isForced &lt;lgl&gt;, isUnforced &lt;lgl&gt;, isDouble &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   PtWinner &lt;dbl&gt;, isSvrWinner &lt;dbl&gt;, rallyCount &lt;dbl&gt;, `Player 1` &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   `Player 2` &lt;chr&gt;, `Pl 1 hand` &lt;chr&gt;, `Pl 2 hand` &lt;chr&gt;, Gender &lt;chr&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The observations of the data set correspond to points played (so there is one row per point). There are a ton of variables in this data set, but the most important variable is the first variable, <code>point</code>, which contains a string with information about the types of shots that were played during the point. The coding of the <code>point</code> variable includes:</p>
<ul>
<li>
<code>4</code> for serve out wide, <code>5</code> for serve into the body, and <code>6</code> for a serve “down the t (center)”.</li>
<li>
<code>f</code> for forehand stroke, <code>b</code> for backhand stroke.</li>
<li>
<code>1</code> to a right-hander’s forehand side, <code>2</code> for down the middle of the court, and <code>3</code> to a right-hander’s backhand side.</li>
<li>
<code>d</code> for a ball hit deep, <code>w</code> for a ball hit wide, and <code>n</code> for a ball hit into the net</li>
<li>
<code>@</code> symbol at the end if the point ended in an unforced error</li>
<li>and there’s lots of other numbers and symbols that correspond to other things (volleys, return depths, hitting the top of the net, etc.)</li>
</ul>
<p>For example, Djokovic served the 7th point of the match, which has a <code>point</code> value of <code>4f18f1f2b3b2f1w@</code>. This reads that</p>
<ul>
<li>
<code>4</code>: Djokovic served out wide,</li>
<li>
<code>f18</code>: Medvedev hit a forehand cross-court to Djokovic’s forehand side</li>
<li>
<code>f1</code>: Djokovic hit a forehand cross-court to Medvedev’s forehand side</li>
<li>
<code>f2</code>: Medvedev hit a forehand to the center of the court</li>
<li>
<code>b3</code>: Djokovic hit a backhand to Medvedev’s backhand side</li>
<li>
<code>b2</code>: Medvedev hit a backhand to the center of the court</li>
<li>
<code>f1w@</code>: Djokovic hit a forehand to Medvedev’s forehand side, but the shot landed wide and was recorded as an unforced error.</li>
</ul>
<p>Clearly, there is a lot of data encoded in the <code>point</code> variable. We are going to introduce <code>stringr</code> by answering a relatively simple question: what are the serving patterns of Medvedev and Djokovic during this match?</p>
<section id="regular-expressions" class="level3" data-number="13.2.1"><h3 data-number="13.2.1" class="anchored" data-anchor-id="regular-expressions">
<span class="header-section-number">13.2.1</span> Regular Expressions</h3>
<p>A <strong>regex</strong>, or <strong>regular expression</strong>, is a string used to identify particular patterns in string data.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Regular expressions are used in <strong>many</strong> languages (so, if you google something about a regular expression, you do not need to limit yourself to just looking at resources pertaining to <code>R</code>).</p>
</div>
</div>
<p>Regex’s can be used with the functions in the <code>stringr</code> package.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The functions in the <code>stringr</code> package begin with <code>str_()</code>, much like the functions in <code>forcats</code> began with <code>fct_()</code>.</p>
</div>
</div>
<p>We will first focus on the <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> function, which detects whether a particular regex is present in a string variable. <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> takes the name of the string as its first argument and the regex as the second argument. For example,</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">med_djok_df</span><span class="op">$</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"f"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</span></span>
<span><span class="co">#&gt;  [13]  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE</span></span>
<span><span class="co">#&gt;  [25]  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE FALSE</span></span>
<span><span class="co">#&gt;  [37]  TRUE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE</span></span>
<span><span class="co">#&gt;  [49] FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE  TRUE FALSE</span></span>
<span><span class="co">#&gt;  [61]  TRUE  TRUE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE</span></span>
<span><span class="co">#&gt;  [73] FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE</span></span>
<span><span class="co">#&gt;  [85]  TRUE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE</span></span>
<span><span class="co">#&gt;  [97]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE</span></span>
<span><span class="co">#&gt; [109] FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE FALSE  TRUE FALSE  TRUE  TRUE</span></span>
<span><span class="co">#&gt; [121]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE</span></span>
<span><span class="co">#&gt; [133]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE</span></span>
<span><span class="co">#&gt; [145] FALSE  TRUE FALSE FALSE  TRUE  TRUE FALSE  TRUE FALSE FALSE  TRUE  TRUE</span></span>
<span><span class="co">#&gt; [157]  TRUE FALSE  TRUE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE</span></span>
<span><span class="co">#&gt; [169] FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</span></span>
<span><span class="co">#&gt; [181] FALSE FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>returns a <code>TRUE</code> if the letter <code>f</code> appears anywhere in the string and a <code>FALSE</code> if it does not. So, we can examine how many points a forehand was hit in the Medvedev-Djokovic match.</p>
</section><section id="stringr-functions-with-dplyr" class="level3" data-number="13.2.2"><h3 data-number="13.2.2" class="anchored" data-anchor-id="stringr-functions-with-dplyr">
<span class="header-section-number">13.2.2</span> <code>stringr</code> Functions with <code>dplyr</code>
</h3>
<p>We can combine the <code>stringr</code> functions with <code>dplyr</code> functions that we already know and love. For example, if we are only interested in points the end in an unforced error (so points that have the <code>@</code> symbol in them), we can filter out the points that don’t have an <code>@</code>:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">med_djok_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"@"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 63 × 46</span></span>
<span><span class="co">#&gt;   point      Serving match_id    Pt  Set1  Set2   Gm1   Gm2 Pts   `Gm#` TbSet</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 4f2d@      ND      2021091…     1     0     0     0     0 0-0   1 (1)     1</span></span>
<span><span class="co">#&gt; 2 6b29f3b3b… ND      2021091…     3     0     0     0     0 15-15 1 (3)     1</span></span>
<span><span class="co">#&gt; 3 5b37b3b3b… ND      2021091…     5     0     0     0     0 40-15 1 (5)     1</span></span>
<span><span class="co">#&gt; 4 4f18f1f2b… ND      2021091…     7     0     0     0     0 40-40 1 (7)     1</span></span>
<span><span class="co">#&gt; 5 5b28f1f2f… ND      2021091…     8     0     0     0     0 40-AD 1 (8)     1</span></span>
<span><span class="co">#&gt; 6 6b27f2f2b… DM      2021091…    13     0     0     0     1 40-15 2 (5)     1</span></span>
<span><span class="co">#&gt; # ℹ 57 more rows</span></span>
<span><span class="co">#&gt; # ℹ 35 more variables: `TB?` &lt;dbl&gt;, TBpt &lt;lgl&gt;, Svr &lt;dbl&gt;, Ret &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1st` &lt;chr&gt;, `2nd` &lt;chr&gt;, Notes &lt;chr&gt;, `1stSV` &lt;dbl&gt;, `2ndSV` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   `1stIn` &lt;dbl&gt;, `2ndIn` &lt;dbl&gt;, isAce &lt;lgl&gt;, isUnret &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   isRallyWinner &lt;lgl&gt;, isForced &lt;lgl&gt;, isUnforced &lt;lgl&gt;, isDouble &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   PtWinner &lt;dbl&gt;, isSvrWinner &lt;dbl&gt;, rallyCount &lt;dbl&gt;, `Player 1` &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   `Player 2` &lt;chr&gt;, `Pl 1 hand` &lt;chr&gt;, `Pl 2 hand` &lt;chr&gt;, Gender &lt;chr&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> to create a variable corresponding to error type and then <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> the error types made from the two players.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">med_djok_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"@"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>error_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"d@"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"deep error"</span>,</span>
<span>                                <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"w@"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"wide error"</span>,</span>
<span>                                <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"n@"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"net error"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">PtWinner</span>, <span class="va">error_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_errors <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 3</span></span>
<span><span class="co">#&gt; # Groups:   PtWinner [2]</span></span>
<span><span class="co">#&gt;   PtWinner error_type n_errors</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1        1 deep error        9</span></span>
<span><span class="co">#&gt; 2        1 net error         6</span></span>
<span><span class="co">#&gt; 3        1 wide error       10</span></span>
<span><span class="co">#&gt; 4        2 deep error       12</span></span>
<span><span class="co">#&gt; 5        2 net error        16</span></span>
<span><span class="co">#&gt; 6        2 wide error        9</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the output above, a <code>PtWinner</code> of <code>1</code> corresponds to points that Djokovic won (and therefore points where Medvedev made the unforced error) while a <code>PtWinner</code> of <code>2</code> corresponds to points that Medvedev won (and therefore points where Djokovic made the unforced error). So we see that, in this match, Djokovic had more unforced errors overall. Medvedev’s unforced errors tended to be deep or wide while the highest proportion of Djokovic’s unforced errors were balls that went into the net.</p>
<p>We will explore our original “service patterns” question in the exercises. To close out this section, we will just emphasize that we have done a <strong>very</strong> simple introduction into regexes. These can get very cumbersome, especially as the patterns you want to extract get more complicated. Consider the examples below.</p>
<ul>
<li>Detect which points are aces, which are coded in the variable as <code>*</code>. Regexes have “special characters, like <code>\</code>, <code>*</code>, <code>.</code>, which, if present in the variable need to be”escaped” with a backslash. But, the backslash is a special character, so it needs to be escaped too: so we need two <code>\\</code> in front of <code>*</code> to pull the points with a <code>*</code>.</li>
</ul>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">med_djok_df</span><span class="op">$</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"\\*"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<ul>
<li>Detect which points start with a <code>4</code> using <code>^</code> to denote “at the beginning”:</li>
</ul>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">med_djok_df</span><span class="op">$</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"^4"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<ul>
<li>Detect which points end with an <code>@</code> using <code>$</code> to denote “at the end” (this is safer than what we did in the code above, where we just assumed that <code>@</code> did not appear anywhere else in the string except at the end).</li>
</ul>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">med_djok_df</span><span class="op">$</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"@$"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<ul>
<li>Extract all of the forehand shots that were hit with <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all()</a></code>. The regex here says to extract anything with an f followed by any number of digits before another non-digit symbol.</li>
</ul>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">med_djok_df</span><span class="op">$</span><span class="va">point</span>, pattern <span class="op">=</span> <span class="st">"f[:digit:]+"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The purpose of these examples is just to show that things can get more complicated with strings.</p>
<p><strong>Exercise 4</strong>. Use <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> and the <code>dplyr</code> functions <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> to create a variable for <code>serve_location</code> that is either <code>"wide"</code> if the <code>point</code> starts with a <code>4</code>, <code>"body"</code> if the <code>point</code> starts with a <code>5</code>, and <code>"down the center"</code> if the <code>point</code> starts with a <code>6</code>.</p>
</section></section><section id="practice" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="practice">
<span class="header-section-number">13.3</span> Practice</h2>
<section id="class-exercises" class="level3" data-number="13.3.1"><h3 data-number="13.3.1" class="anchored" data-anchor-id="class-exercises">
<span class="header-section-number">13.3.1</span> Class Exercises</h3>
<p><strong>Class Exercise 1</strong>. Two of the more popular television shows, the office and friends, have <code>R</code> packages containing clean-up scripts for the entire series. For the show <em>The Office</em>, choose a character (e.g., Michael, Jim, Pam, Dwight, Kevin, Angela, Kelly, Andy, etc.), and construct a plot that lets you explore the most common words that character said in the series.</p>
<p>Then, assess whether the character you chose seems to speak more or speak less, on average, from season to season.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## install.packages("schrute")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bradlindblad/schrute">schrute</a></span><span class="op">)</span></span>
<span><span class="fu">schrute</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/schrute/man/theoffice.html">theoffice</a></span></span>
<span></span>
<span><span class="co">## install.packages("friends")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EmilHvitfeldt/friends">friends</a></span><span class="op">)</span></span>
<span><span class="fu">friends</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/friends/man/friends.html">friends</a></span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="your-turn" class="level3" data-number="13.3.2"><h3 data-number="13.3.2" class="anchored" data-anchor-id="your-turn">
<span class="header-section-number">13.3.2</span> Your Turn</h3>
<p><strong>Your Turn 1</strong>. Using the tennis data, construct a plot that lets you explore how often each of the two players hit their serve “down the t,” “into the body,” and “out wide.”</p>
<p><strong>Your Turn 2</strong>. Can you modify your plot to additionally visualize how often each player ended up <strong>winning</strong> the point when they served to each of the three locations (down the t, into the body, and out wide).</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>isSrvWinner</code> variable is coded as a <code>1</code> if the serving player won the point and <code>0</code> if the serving player lost the point.</p>
</div>
</div>
<p><strong>Your Turn 3</strong>. The letters <code>v</code>, <code>z</code>, <code>i</code>, and <code>k</code> denote volleys (of different types). Use <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> and <code>dplyr</code> functions to figure out the proportion of points where a volley was hit.</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./11-lubridate.html" class="pagination-link" aria-label="Dates with `lubridate`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dates with <code>lubridate</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13-knn.html" class="pagination-link" aria-label="Predictive Modeling with knn">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Predictive Modeling with knn</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Course Materials were written by Matt Higham for STAT/DATA 234 at St.&nbsp;Lawrence University.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>