<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> 12 Merging with dplyr | STAT 234: Data Science</title>
<meta name="author" content="Matt Higham">
<meta name="description" content="Goals: use bind_rows() to stack two data sets and bind_cols() to merge two data sets. identify keys in two related data sets. use the mutating join functions in dplyr to merge two data sets by a...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content=" 12 Merging with dplyr | STAT 234: Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://highamm.github.io/datascience234/merging-with-dplyr.html">
<meta property="og:description" content="Goals: use bind_rows() to stack two data sets and bind_cols() to merge two data sets. identify keys in two related data sets. use the mutating join functions in dplyr to merge two data sets by a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" 12 Merging with dplyr | STAT 234: Data Science">
<meta name="twitter:description" content="Goals: use bind_rows() to stack two data sets and bind_cols() to merge two data sets. identify keys in two related data sets. use the mutating join functions in dplyr to merge two data sets by a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT 234: Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Syllabus and Course Information</a></li>
<li class="book-part">The Core: tidyverse Basics</li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Getting Started with R and R Studio</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">3</span> Plotting with ggplot2</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">4</span> Wrangling with dplyr</a></li>
<li><a class="" href="communication-with-quarto.html"><span class="header-section-number">5</span> Communication with Quarto</a></li>
<li><a class="" href="workflow.html"><span class="header-section-number">6</span> Workflow and Other Skills</a></li>
<li class="book-part">Data Wrangling</li>
<li><a class="" href="tidying-with-tidyr.html"><span class="header-section-number">7</span> Tidying with tidyr</a></li>
<li><a class="" href="coding-in-base-r.html"><span class="header-section-number">8</span> Coding in Base R</a></li>
<li><a class="" href="factors-with-forcats.html"><span class="header-section-number">9</span> Factors with forcats</a></li>
<li><a class="" href="data-ethics.html"><span class="header-section-number">10</span> Data Ethics</a></li>
<li><a class="" href="data-import.html"><span class="header-section-number">11</span> Data Import</a></li>
<li><a class="active" href="merging-with-dplyr.html"><span class="header-section-number">12</span> Merging with dplyr</a></li>
<li class="book-part">Special Topics</li>
<li><a class="" href="dates-with-lubridate.html"><span class="header-section-number">13</span> Dates with lubridate</a></li>
<li><a class="" href="text-data-with-tidytext-and-stringr.html"><span class="header-section-number">14</span> Text Data with tidytext and stringr</a></li>
<li><a class="" href="predictive-modeling-with-knn.html"><span class="header-section-number">15</span> Predictive Modeling with knn</a></li>
<li><a class="" href="connections-to-stat-113-stat-213-and-cs-140.html"><span class="header-section-number">16</span> Connections to STAT 113, STAT 213, and CS 140</a></li>
<li><a class="" href="introduction-to-sql-with-dbplyr.html"><span class="header-section-number">17</span> Introduction to SQL with dbplyr</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="merging-with-dplyr" class="section level1" number="12">
<h1>
<span class="header-section-number"> 12</span> Merging with <code>dplyr</code><a class="anchor" aria-label="anchor" href="#merging-with-dplyr"><i class="fas fa-link"></i></a>
</h1>
<p><strong>Goals:</strong></p>
<ul>
<li><p>use <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> to stack two data sets and <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> to merge two data sets.</p></li>
<li><p>identify <strong>keys</strong> in two related data sets.</p></li>
<li><p>use the mutating join functions in <code>dplyr</code> to merge two data sets by a key.</p></li>
<li><p>use the filtering join functions in <code>dplyr</code> to filter one data set by values in another data set.</p></li>
<li><p>apply the appropriate <code>join()</code> function for a given problem and context.</p></li>
</ul>
<div id="stacking-rows-and-appending-columns" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Stacking Rows and Appending Columns<a class="anchor" aria-label="anchor" href="#stacking-rows-and-appending-columns"><i class="fas fa-link"></i></a>
</h2>
<div id="stacking-with-bind_rows" class="section level3" number="12.1.1">
<h3>
<span class="header-section-number">12.1.1</span> Stacking with <code>bind_rows()</code><a class="anchor" aria-label="anchor" href="#stacking-with-bind_rows"><i class="fas fa-link"></i></a>
</h3>
<p>First, we will talk about combining two data sets by “stacking” them on top of each other to form one new data set. The <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> function can be used for this purpose <strong>if</strong> the two data sets have identical column names.</p>
<p>A common instance where this is useful is if two data sets come from the same source and have different locations or years, but the same exact column names.</p>
<p>For example, examine the following website and notice how there are .csv files given for each year of matches in the ATP (Association of (men’s) Tennis Professionals). <a href="https://github.com/JeffSackmann/tennis_atp" target="_blank">https://github.com/JeffSackmann/tennis_atp</a>.</p>
<p>Then, read in the data sets, and look at how many columns each has.</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="va">atp_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2019.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">atp_2019</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">atp_2018</span><span class="op">)</span></span></code></pre></div>
<p>To combine results from both data sets,</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">atp_2018</span>, <span class="va">atp_2019</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `bind_rows()`:</span></span>
<span><span class="co">#&gt; ! Can't combine `winner_seed` &lt;double&gt; and `winner_seed` &lt;character&gt;.</span></span></code></pre></div>
<p>What happens? Can you fix the error? <strong>Hint</strong>: run</p>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/spec.html">spec</a></span><span class="op">(</span><span class="va">atp_2018</span><span class="op">)</span></span></code></pre></div>
<p>to get the full column specifications and use your <code>readr</code> knowledge to change a couple of the column types. We also did not discuss this, but, when using the <code>col_type</code> argument in <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>, you don’t need to specify all of the column types. Just specifying the ones that you want to change works too. The following code forces the seed variables in the 2018 data set to be characters.</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span>,</span>
<span>                     col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>winner_seed <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                      loser_seed <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can try combining the data sets now.</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">atp_2018</span>, <span class="va">atp_2019</span><span class="op">)</span></span>
<span><span class="va">atp_df</span></span></code></pre></div>
<p>Do a quick check to make sure the number of rows in <code>atp_2018</code> plus the number of rows in <code>atp_2019</code> equals the number of rows in <code>atp_df</code>.</p>
<p>It might seem a little annoying, but, by default <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> will only combine two data sets by stacking rows if the data sets have <strong>identical</strong> column names and <strong>identical</strong> column classes, as we saw in the previous example.</p>
<p>Now run the following and look at the output.</p>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_test2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test2a</span>, <span class="va">df_test2b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;    xvar     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    NA</span></span>
<span><span class="co">#&gt; 2     2    NA</span></span>
<span><span class="co">#&gt; 3     1     5</span></span>
<span><span class="co">#&gt; 4     2     1</span></span></code></pre></div>
<p>Is this the behavior you would expect?</p>
<p><br></p>
</div>
<div id="binding-columns-with-bind_cols" class="section level3" number="12.1.2">
<h3>
<span class="header-section-number">12.1.2</span> Binding Columns with <code>bind_cols()</code><a class="anchor" aria-label="anchor" href="#binding-columns-with-bind_cols"><i class="fas fa-link"></i></a>
</h3>
<p>We won’t spend much time talking about how to bind together columns because it’s generally a little dangerous.</p>
<p>We will use a couple of test data sets, <code>df_test1a</code> and <code>df_test1b</code>, to see it in action:</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;    xvar  yvar     x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     5     1     5</span></span>
<span><span class="co">#&gt; 2     2     1     2     1</span></span></code></pre></div>
<p>For a larger data set, why might this be a dangerous way to combine data? What must you be sure of about the way the data was collected in order to combine data in this way?</p>
</div>
<div id="exercise-10-1" class="section level3" number="12.1.3">
<h3>
<span class="header-section-number">12.1.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-10-1"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="merging-with-dplyr.html#solutions-10">12.5</a>.</p>
<ol style="list-style-type: decimal">
<li>* Run the following and explain why <code>R</code> does not simply stack the rows. Then, fix the issue with the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function.</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;    xvar  yvar     x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     5    NA    NA</span></span>
<span><span class="co">#&gt; 2     2     1    NA    NA</span></span>
<span><span class="co">#&gt; 3    NA    NA     1     5</span></span>
<span><span class="co">#&gt; 4    NA    NA     2     1</span></span></code></pre></div>
</div>
</div>
<div id="mutating-joins" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Mutating Joins<a class="anchor" aria-label="anchor" href="#mutating-joins"><i class="fas fa-link"></i></a>
</h2>
<p>If the goal is to combine two data sets using some common variable(s) that both data sets have, we need different tools than simply stacking rows or appending columns. When merging together two or more data sets, we need to have a matching identification variable in each data set. This variable is commonly called a <strong>key</strong>. A key can be an identification number, a name, a date, etc, but must be present in both data sets.</p>
<p>As a simple first example, consider</p>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>, <span class="st">"Miguel"</span>, <span class="st">"Tonya"</span><span class="op">)</span>, fav_sport <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Swimming"</span>, <span class="st">"Football"</span>, <span class="st">"Tennis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tonya"</span>, <span class="st">"Miguel"</span>, <span class="st">"Emily"</span><span class="op">)</span>,</span>
<span>              fav_colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Robin's Egg Blue"</span>, <span class="st">"Tickle Me Pink"</span>, <span class="st">"Goldenrod"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Our goal is to combine the two data sets so that the people’s favorite sports and favorite colours are in one data set.</p>
<p>Identify the <code>key</code> in the example above. Why can we no longer use <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> here?</p>
<div id="keep-all-rows-of-data-set-1-with-left_join" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> Keep All Rows of Data Set 1 with <code>left_join()</code><a class="anchor" aria-label="anchor" href="#keep-all-rows-of-data-set-1-with-left_join"><i class="fas fa-link"></i></a>
</h3>
<p>Consider the <code>babynames</code> <code>R</code> package, which has the following data sets:</p>
<ul>
<li>
<code>lifetables</code>: cohort life tables for different <code>sex</code> and different <code>year</code> variables, starting at the year 1900.</li>
<li>
<code>births</code>: the number of births in the United States in each year, since 1909</li>
<li>
<code>babynames</code>: popularity of different baby names per year and sex since the year 1880.</li>
</ul>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##install.packages("babynames")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span></span>
<span><span class="va">life_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/lifetables.html">lifetables</a></span></span>
<span><span class="va">birth_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/births.html">births</a></span></span>
<span><span class="va">babynames_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/babynames.html">babynames</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">babynames</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">births</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lifetables</span><span class="op">)</span></span></code></pre></div>
<p>Read about each data set with <code><a href="https://rdrr.io/pkg/babynames/man/babynames.html">?babynames</a></code>, <code><a href="https://rdrr.io/pkg/babynames/man/births.html">?births</a></code> and <code><a href="https://rdrr.io/pkg/babynames/man/lifetables.html">?lifetables</a></code>.</p>
<p>Suppose that you want to combine the <code>births</code> data set with the <code>babynames</code> data set, so that each row of <code>babynames</code> now has the total number of births for that year. We first need to identify the key in each data set that we will use for the joining. In this case, each data set has a <code>year</code> variable, and we can use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> to keep all observations in <code>babynames_df</code>, even for years that are not in the <code>births_df</code> data set.</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">combined_left</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;    year sex   name          n   prop births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  1880 F     Mary       7065 0.0724     NA</span></span>
<span><span class="co">#&gt; 2  1880 F     Anna       2604 0.0267     NA</span></span>
<span><span class="co">#&gt; 3  1880 F     Emma       2003 0.0205     NA</span></span>
<span><span class="co">#&gt; 4  1880 F     Elizabeth  1939 0.0199     NA</span></span>
<span><span class="co">#&gt; 5  1880 F     Minnie     1746 0.0179     NA</span></span>
<span><span class="co">#&gt; 6  1880 F     Margaret   1578 0.0162     NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">combined_left</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;    year sex   name       n       prop  births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2017 M     Zyhier     5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 2  2017 M     Zykai      5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 3  2017 M     Zykeem     5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 4  2017 M     Zylin      5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 5  2017 M     Zylis      5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 6  2017 M     Zyrie      5 0.00000255 3855500</span></span></code></pre></div>
<p>Why are <code>births</code> missing in <code>head(combined_left)</code> but not in <code>tail(combined_left)</code>?</p>
</div>
<div id="keep-all-rows-of-data-set-2-with-right_join" class="section level3" number="12.2.2">
<h3>
<span class="header-section-number">12.2.2</span> Keep All Rows of Data Set 2 with <code>right_join()</code><a class="anchor" aria-label="anchor" href="#keep-all-rows-of-data-set-2-with-right_join"><i class="fas fa-link"></i></a>
</h3>
<p>Recall from the accompanying handout that there is no need to ever use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> because it is the same as using a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> with the first two data set arguments switched:</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## these will always do the same exact thing</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;     year sex   name          n   prop  births</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  1909 F     Mary      19259 0.0523 2718000</span></span>
<span><span class="co">#&gt;  2  1909 F     Helen      9250 0.0251 2718000</span></span>
<span><span class="co">#&gt;  3  1909 F     Margaret   7359 0.0200 2718000</span></span>
<span><span class="co">#&gt;  4  1909 F     Ruth       6509 0.0177 2718000</span></span>
<span><span class="co">#&gt;  5  1909 F     Dorothy    6253 0.0170 2718000</span></span>
<span><span class="co">#&gt;  6  1909 F     Anna       5804 0.0158 2718000</span></span>
<span><span class="co">#&gt;  7  1909 F     Elizabeth  5176 0.0141 2718000</span></span>
<span><span class="co">#&gt;  8  1909 F     Mildred    5054 0.0137 2718000</span></span>
<span><span class="co">#&gt;  9  1909 F     Marie      4301 0.0117 2718000</span></span>
<span><span class="co">#&gt; 10  1909 F     Alice      4170 0.0113 2718000</span></span>
<span><span class="co">#&gt; # … with 1,839,942 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">birth_df</span>, <span class="va">babynames_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;     year  births sex   name          n   prop</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  1909 2718000 F     Mary      19259 0.0523</span></span>
<span><span class="co">#&gt;  2  1909 2718000 F     Helen      9250 0.0251</span></span>
<span><span class="co">#&gt;  3  1909 2718000 F     Margaret   7359 0.0200</span></span>
<span><span class="co">#&gt;  4  1909 2718000 F     Ruth       6509 0.0177</span></span>
<span><span class="co">#&gt;  5  1909 2718000 F     Dorothy    6253 0.0170</span></span>
<span><span class="co">#&gt;  6  1909 2718000 F     Anna       5804 0.0158</span></span>
<span><span class="co">#&gt;  7  1909 2718000 F     Elizabeth  5176 0.0141</span></span>
<span><span class="co">#&gt;  8  1909 2718000 F     Mildred    5054 0.0137</span></span>
<span><span class="co">#&gt;  9  1909 2718000 F     Marie      4301 0.0117</span></span>
<span><span class="co">#&gt; 10  1909 2718000 F     Alice      4170 0.0113</span></span>
<span><span class="co">#&gt; # … with 1,839,942 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Therefore, it’s usually easier to just always use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> and ignore <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> completely.</p>
</div>
<div id="keep-all-rows-of-both-data-sets-with-full_join" class="section level3" number="12.2.3">
<h3>
<span class="header-section-number">12.2.3</span> Keep All Rows of Both Data Sets with <code>full_join()</code><a class="anchor" aria-label="anchor" href="#keep-all-rows-of-both-data-sets-with-full_join"><i class="fas fa-link"></i></a>
</h3>
<p>A <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> will keep all rows in data set 1 that don’t have a matching key in data set 2, and will also keep all rows in data set 2 that don’t have a matching key in data set 1, filling in <code>NA</code> for missing values when necessary. For our example of merging <code>babynames_df</code> with <code>birth_df</code>,</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="keep-only-rows-with-matching-keys-with-inner_join" class="section level3" number="12.2.4">
<h3>
<span class="header-section-number">12.2.4</span> Keep Only Rows with Matching Keys with <code>inner_join()</code><a class="anchor" aria-label="anchor" href="#keep-only-rows-with-matching-keys-with-inner_join"><i class="fas fa-link"></i></a>
</h3>
<p>We can also keep only rows with matching keys with <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>. For this join, any row in data set 1 without a matching key in data set 2 is dropped, and any row in data set 2 without a matching key in data set 1 is also dropped.</p>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;     year sex   name          n   prop  births</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  1909 F     Mary      19259 0.0523 2718000</span></span>
<span><span class="co">#&gt;  2  1909 F     Helen      9250 0.0251 2718000</span></span>
<span><span class="co">#&gt;  3  1909 F     Margaret   7359 0.0200 2718000</span></span>
<span><span class="co">#&gt;  4  1909 F     Ruth       6509 0.0177 2718000</span></span>
<span><span class="co">#&gt;  5  1909 F     Dorothy    6253 0.0170 2718000</span></span>
<span><span class="co">#&gt;  6  1909 F     Anna       5804 0.0158 2718000</span></span>
<span><span class="co">#&gt;  7  1909 F     Elizabeth  5176 0.0141 2718000</span></span>
<span><span class="co">#&gt;  8  1909 F     Mildred    5054 0.0137 2718000</span></span>
<span><span class="co">#&gt;  9  1909 F     Marie      4301 0.0117 2718000</span></span>
<span><span class="co">#&gt; 10  1909 F     Alice      4170 0.0113 2718000</span></span>
<span><span class="co">#&gt; # … with 1,839,942 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p><br></p>
</div>
<div id="which-xxxx_join" class="section level3" number="12.2.5">
<h3>
<span class="header-section-number">12.2.5</span> Which <code>xxxx_join()</code>?<a class="anchor" aria-label="anchor" href="#which-xxxx_join"><i class="fas fa-link"></i></a>
</h3>
<p>Which join function we use will depend on the context of the data and what questions you will be answering in your analysis. Most importantly, if you’re using a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, you’re potentially cutting out some data. It’s important to be aware of what data you’re omitting. For example, with the <code>babynames</code> and <code>births</code> data, we would want to keep a note that a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> removed all observations before 1909 from joined data set.</p>
</div>
<div id="the-importance-of-a-good-key" class="section level3" number="12.2.6">
<h3>
<span class="header-section-number">12.2.6</span> The Importance of a Good Key<a class="anchor" aria-label="anchor" href="#the-importance-of-a-good-key"><i class="fas fa-link"></i></a>
</h3>
<p>The key variable is very important for joining and is not always available in a “perfect” form. Recall the college majors data sets we have, called <code>slumajors_df</code>, which information on majors at SLU. Another data set, <code>collegemajors_df</code>, has different statistics on college majors nationwide. There’s lots of interesting variables in these data sets, but we’ll focus on the <code>Major</code> variable here. Read in and examine the two data sets with:</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slumajors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/SLU_Majors_15_19.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">collegemajors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/college-majors.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">slumajors_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   Major                        nfemales nmales</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                           &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Anthropology                       34     15</span></span>
<span><span class="co">#&gt; 2 Art &amp; Art History                  65     11</span></span>
<span><span class="co">#&gt; 3 Biochemistry                       14     11</span></span>
<span><span class="co">#&gt; 4 Biology                           162     67</span></span>
<span><span class="co">#&gt; 5 Business in the Liberal Arts      135    251</span></span>
<span><span class="co">#&gt; 6 Chemistry                          26     14</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">collegemajors_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 12</span></span>
<span><span class="co">#&gt;   Major    Total   Men Women Major…¹ Emplo…² Full_…³ Part_…⁴</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 PETROLE…  2339  2057   282 Engine…    1976    1849     270</span></span>
<span><span class="co">#&gt; 2 MINING …   756   679    77 Engine…     640     556     170</span></span>
<span><span class="co">#&gt; 3 METALLU…   856   725   131 Engine…     648     558     133</span></span>
<span><span class="co">#&gt; 4 NAVAL A…  1258  1123   135 Engine…     758    1069     150</span></span>
<span><span class="co">#&gt; 5 CHEMICA… 32260 21239 11021 Engine…   25694   23170    5180</span></span>
<span><span class="co">#&gt; 6 NUCLEAR…  2573  2200   373 Engine…    1857    2038     264</span></span>
<span><span class="co">#&gt; # … with 4 more variables: Unemployed &lt;dbl&gt;, Median &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   P25th &lt;dbl&gt;, P75th &lt;dbl&gt;, and abbreviated variable</span></span>
<span><span class="co">#&gt; #   names ¹​Major_category, ²​Employed, ³​Full_time,</span></span>
<span><span class="co">#&gt; #   ⁴​Part_time</span></span>
<span><span class="co">#&gt; # ℹ Use `colnames()` to see all variable names</span></span></code></pre></div>
<p>The most logical key for joining these two data sets is <code>Major</code>, but joining the data sets won’t actually work. The following is an attempt at using <code>Major</code> as the key.</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">slumajors_df</span>, <span class="va">collegemajors_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major"</span> <span class="op">=</span> <span class="st">"Major"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 27 × 14</span></span>
<span><span class="co">#&gt;    Major    nfema…¹ nmales Total   Men Women Major…² Emplo…³</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Anthrop…      34     15    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  2 Art &amp; A…      65     11    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  3 Biochem…      14     11    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  4 Biology      162     67    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  5 Busines…     135    251    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  6 Chemist…      26     14    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  7 Compute…      21     47    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  8 Conserv…      38     20    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  9 Economi…     128    349    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt; 10 English      131     54    NA    NA    NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt; # … with 17 more rows, 6 more variables: Full_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Part_time &lt;dbl&gt;, Unemployed &lt;dbl&gt;, Median &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   P25th &lt;dbl&gt;, P75th &lt;dbl&gt;, and abbreviated variable</span></span>
<span><span class="co">#&gt; #   names ¹​nfemales, ²​Major_category, ³​Employed</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<p>Why did the <code>collegemajors_df</code> give only <code>NA</code> values when we tried to merge by major?</p>
<p>This example underscores the importance of having a key that matches <strong>exactly</strong>. Some, but not all, of the issues involved in joining these two data sets can be solved with functions in the <code>stringr</code> package (discussed in a few weeks). For example, the capitalization issue can be solved with the <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title()</a></code> function, which converts that all-caps majors in <code>collegemajors_df</code> to majors where only the first letter of each word is capitalized:</p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collegemajors_df</span> <span class="op">&lt;-</span> <span class="va">collegemajors_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Major <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">Major</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">slumajors_df</span>, <span class="va">collegemajors_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = "Major"</span></span>
<span><span class="co">#&gt; # A tibble: 27 × 14</span></span>
<span><span class="co">#&gt;    Major nfema…¹ nmales  Total    Men  Women Major…² Emplo…³</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Anth…      34     15     NA     NA     NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  2 Art …      65     11     NA     NA     NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  3 Bioc…      14     11     NA     NA     NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  4 Biol…     162     67 280709 111762 168947 Biolog…  182295</span></span>
<span><span class="co">#&gt;  5 Busi…     135    251     NA     NA     NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  6 Chem…      26     14  66530  32923  33607 Physic…   48535</span></span>
<span><span class="co">#&gt;  7 Comp…      21     47 128319  99743  28576 Comput…  102087</span></span>
<span><span class="co">#&gt;  8 Cons…      38     20     NA     NA     NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt;  9 Econ…     128    349 139247  89749  49498 Social…  104117</span></span>
<span><span class="co">#&gt; 10 Engl…     131     54     NA     NA     NA &lt;NA&gt;         NA</span></span>
<span><span class="co">#&gt; # … with 17 more rows, 6 more variables: Full_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Part_time &lt;dbl&gt;, Unemployed &lt;dbl&gt;, Median &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   P25th &lt;dbl&gt;, P75th &lt;dbl&gt;, and abbreviated variable</span></span>
<span><span class="co">#&gt; #   names ¹​nfemales, ²​Major_category, ³​Employed</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<p>As we can see, this solves the issue for some majors but others still have different naming conventions in the two data sets.</p>
</div>
<div id="exercise-10-2" class="section level3" number="12.2.7">
<h3>
<span class="header-section-number">12.2.7</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-10-2"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="merging-with-dplyr.html#solutions-10">12.5</a>.</p>
<ol style="list-style-type: decimal">
<li>Examine the following two joins that we’ve done, and explain why one resulting data set has fewer observations (rows) than the other.</li>
</ol>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,924,665 × 6</span></span>
<span><span class="co">#&gt;     year sex   name          n   prop births</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  1880 F     Mary       7065 0.0724     NA</span></span>
<span><span class="co">#&gt;  2  1880 F     Anna       2604 0.0267     NA</span></span>
<span><span class="co">#&gt;  3  1880 F     Emma       2003 0.0205     NA</span></span>
<span><span class="co">#&gt;  4  1880 F     Elizabeth  1939 0.0199     NA</span></span>
<span><span class="co">#&gt;  5  1880 F     Minnie     1746 0.0179     NA</span></span>
<span><span class="co">#&gt;  6  1880 F     Margaret   1578 0.0162     NA</span></span>
<span><span class="co">#&gt;  7  1880 F     Ida        1472 0.0151     NA</span></span>
<span><span class="co">#&gt;  8  1880 F     Alice      1414 0.0145     NA</span></span>
<span><span class="co">#&gt;  9  1880 F     Bertha     1320 0.0135     NA</span></span>
<span><span class="co">#&gt; 10  1880 F     Sarah      1288 0.0132     NA</span></span>
<span><span class="co">#&gt; # … with 1,924,655 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">birth_df</span>, <span class="va">babynames_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;     year  births sex   name          n   prop</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  1909 2718000 F     Mary      19259 0.0523</span></span>
<span><span class="co">#&gt;  2  1909 2718000 F     Helen      9250 0.0251</span></span>
<span><span class="co">#&gt;  3  1909 2718000 F     Margaret   7359 0.0200</span></span>
<span><span class="co">#&gt;  4  1909 2718000 F     Ruth       6509 0.0177</span></span>
<span><span class="co">#&gt;  5  1909 2718000 F     Dorothy    6253 0.0170</span></span>
<span><span class="co">#&gt;  6  1909 2718000 F     Anna       5804 0.0158</span></span>
<span><span class="co">#&gt;  7  1909 2718000 F     Elizabeth  5176 0.0141</span></span>
<span><span class="co">#&gt;  8  1909 2718000 F     Mildred    5054 0.0137</span></span>
<span><span class="co">#&gt;  9  1909 2718000 F     Marie      4301 0.0117</span></span>
<span><span class="co">#&gt; 10  1909 2718000 F     Alice      4170 0.0113</span></span>
<span><span class="co">#&gt; # … with 1,839,942 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Evaluate whether the following statement is true or false: an <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> will always result in a data set with the same or fewer rows than a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>.</p></li>
<li><p>Evaluate whether the following statement is true or false: an <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> will always result in a data set with the same or fewer rows than a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>.</p></li>
</ol>
</div>
</div>
<div id="filtering-joins" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Filtering Joins<a class="anchor" aria-label="anchor" href="#filtering-joins"><i class="fas fa-link"></i></a>
</h2>
<p>Filtering joins (<code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>) are useful if you would only like to keep the variables in one data set, but you want to filter out observations by a variable in the second data set.</p>
<p>Consider again the two data sets on men’s tennis matches in 2018 and in 2019.</p>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atp_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2019.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2019</span></span>
<span><span class="co">#&gt; # A tibble: 2,781 × 49</span></span>
<span><span class="co">#&gt;    tourney…¹ tourn…² surface draw_…³ tourn…⁴ tourn…⁵ match…⁶</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2019-M020 Brisba… Hard         32 A        2.02e7     300</span></span>
<span><span class="co">#&gt;  2 2019-M020 Brisba… Hard         32 A        2.02e7     299</span></span>
<span><span class="co">#&gt;  3 2019-M020 Brisba… Hard         32 A        2.02e7     298</span></span>
<span><span class="co">#&gt;  4 2019-M020 Brisba… Hard         32 A        2.02e7     297</span></span>
<span><span class="co">#&gt;  5 2019-M020 Brisba… Hard         32 A        2.02e7     296</span></span>
<span><span class="co">#&gt;  6 2019-M020 Brisba… Hard         32 A        2.02e7     295</span></span>
<span><span class="co">#&gt;  7 2019-M020 Brisba… Hard         32 A        2.02e7     294</span></span>
<span><span class="co">#&gt;  8 2019-M020 Brisba… Hard         32 A        2.02e7     293</span></span>
<span><span class="co">#&gt;  9 2019-M020 Brisba… Hard         32 A        2.02e7     292</span></span>
<span><span class="co">#&gt; 10 2019-M020 Brisba… Hard         32 A        2.02e7     291</span></span>
<span><span class="co">#&gt; # … with 2,771 more rows, 42 more variables:</span></span>
<span><span class="co">#&gt; #   winner_id &lt;dbl&gt;, winner_seed &lt;chr&gt;, winner_entry &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   winner_name &lt;chr&gt;, winner_hand &lt;chr&gt;, winner_ht &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   winner_ioc &lt;chr&gt;, winner_age &lt;dbl&gt;, loser_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   loser_seed &lt;chr&gt;, loser_entry &lt;chr&gt;, loser_name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   loser_hand &lt;chr&gt;, loser_ht &lt;dbl&gt;, loser_ioc &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   loser_age &lt;dbl&gt;, score &lt;chr&gt;, best_of &lt;dbl&gt;, …</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span>
<span><span class="va">atp_2018</span></span>
<span><span class="co">#&gt; # A tibble: 2,889 × 49</span></span>
<span><span class="co">#&gt;    tourney…¹ tourn…² surface draw_…³ tourn…⁴ tourn…⁵ match…⁶</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2018-M020 Brisba… Hard         32 A        2.02e7     271</span></span>
<span><span class="co">#&gt;  2 2018-M020 Brisba… Hard         32 A        2.02e7     272</span></span>
<span><span class="co">#&gt;  3 2018-M020 Brisba… Hard         32 A        2.02e7     273</span></span>
<span><span class="co">#&gt;  4 2018-M020 Brisba… Hard         32 A        2.02e7     275</span></span>
<span><span class="co">#&gt;  5 2018-M020 Brisba… Hard         32 A        2.02e7     276</span></span>
<span><span class="co">#&gt;  6 2018-M020 Brisba… Hard         32 A        2.02e7     277</span></span>
<span><span class="co">#&gt;  7 2018-M020 Brisba… Hard         32 A        2.02e7     278</span></span>
<span><span class="co">#&gt;  8 2018-M020 Brisba… Hard         32 A        2.02e7     279</span></span>
<span><span class="co">#&gt;  9 2018-M020 Brisba… Hard         32 A        2.02e7     280</span></span>
<span><span class="co">#&gt; 10 2018-M020 Brisba… Hard         32 A        2.02e7     282</span></span>
<span><span class="co">#&gt; # … with 2,879 more rows, 42 more variables:</span></span>
<span><span class="co">#&gt; #   winner_id &lt;dbl&gt;, winner_seed &lt;dbl&gt;, winner_entry &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   winner_name &lt;chr&gt;, winner_hand &lt;chr&gt;, winner_ht &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   winner_ioc &lt;chr&gt;, winner_age &lt;dbl&gt;, loser_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   loser_seed &lt;dbl&gt;, loser_entry &lt;chr&gt;, loser_name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   loser_hand &lt;chr&gt;, loser_ht &lt;dbl&gt;, loser_ioc &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   loser_age &lt;dbl&gt;, score &lt;chr&gt;, best_of &lt;dbl&gt;, …</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<div id="filtering-with-semi_join" class="section level3" number="12.3.1">
<h3>
<span class="header-section-number">12.3.1</span> Filtering with <code>semi_join()</code><a class="anchor" aria-label="anchor" href="#filtering-with-semi_join"><i class="fas fa-link"></i></a>
</h3>
<p>Suppose that we only want to keep matches in 2019 where the winning player had 10 or more wins in 2018. This might be useful if we want to not consider players in 2018 that only played in a couple of matches, perhaps because they got injured or perhaps because they received a special wildcard into the draw of only one event.</p>
<p>To accomplish this, we can first create a data set that has the names of all of the players that won 10 or more matches in 2018, using functions that we learned from <code>dplyr</code> earlier in the semester:</p>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">win10</span> <span class="op">&lt;-</span> <span class="va">atp_2018</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">winner_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nwin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nwin</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">win10</span></span>
<span><span class="co">#&gt; # A tibble: 93 × 2</span></span>
<span><span class="co">#&gt;    winner_name       nwin</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;            &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 Adrian Mannarino    26</span></span>
<span><span class="co">#&gt;  2 Albert Ramos        21</span></span>
<span><span class="co">#&gt;  3 Alex De Minaur      29</span></span>
<span><span class="co">#&gt;  4 Alexander Zverev    58</span></span>
<span><span class="co">#&gt;  5 Aljaz Bedene        19</span></span>
<span><span class="co">#&gt;  6 Andreas Seppi       24</span></span>
<span><span class="co">#&gt;  7 Andrey Rublev       20</span></span>
<span><span class="co">#&gt;  8 Benoit Paire        27</span></span>
<span><span class="co">#&gt;  9 Borna Coric         40</span></span>
<span><span class="co">#&gt; 10 Cameron Norrie      19</span></span>
<span><span class="co">#&gt; # … with 83 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Next, we apply <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code>, which takes the names of two data sets (the second is the one that contains information about how the first should be “filtered”). The third argument gives the name of the key (<code>winner_name</code>) in this case.</p>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tennis_2019_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tennis_2019_10</span><span class="op">$</span><span class="va">winner_name</span></span></code></pre></div>
<p>Note that this only keeps the matches in 2019 where the <strong>winner</strong> had 10 or more match wins in 2018. It drops any matches where the <strong>loser</strong> lost against someone who did not have 10 or more match wins in 2018. So this isn’t yet perfect and would take a little more thought into which matches we actually want to keep for a particular analysis.</p>
</div>
<div id="filtering-with-anti_join" class="section level3" number="12.3.2">
<h3>
<span class="header-section-number">12.3.2</span> Filtering with <code>anti_join()</code><a class="anchor" aria-label="anchor" href="#filtering-with-anti_join"><i class="fas fa-link"></i></a>
</h3>
<p>Now suppose that we want to only keep the matches in 2019 where the winning player did not have <strong>any</strong> wins in 2018. We might think of these players as “emerging players” in 2019, players who are coming back from an injury, etc.. To do this, we can use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>, which only keeps the rows in the first data set that do <strong>not</strong> have a match in the second data set.</p>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_winners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">atp_2018</span>,</span>
<span>                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">new_winners</span><span class="op">$</span><span class="va">winner_name</span></span></code></pre></div>
<p>We can then examine how many wins each of these “new” (or perhaps previously injured) players had in 2019:</p>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_winners</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">winner_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nwin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">nwin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 59 × 2</span></span>
<span><span class="co">#&gt;    winner_name           nwin</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 Christian Garin         32</span></span>
<span><span class="co">#&gt;  2 Juan Ignacio Londero    22</span></span>
<span><span class="co">#&gt;  3 Miomir Kecmanovic       22</span></span>
<span><span class="co">#&gt;  4 Hugo Dellien            12</span></span>
<span><span class="co">#&gt;  5 Attila Balazs            7</span></span>
<span><span class="co">#&gt;  6 Cedrik Marcel Stebe      7</span></span>
<span><span class="co">#&gt;  7 Janko Tipsarevic         7</span></span>
<span><span class="co">#&gt;  8 Jannik Sinner            7</span></span>
<span><span class="co">#&gt;  9 Soon Woo Kwon            7</span></span>
<span><span class="co">#&gt; 10 Gregoire Barrere         6</span></span>
<span><span class="co">#&gt; # … with 49 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>The filtering join functions are useful if you want to filter out observations by some criterion in a different data set.</p>
</div>
<div id="exercise-10-3" class="section level3" number="12.3.3">
<h3>
<span class="header-section-number">12.3.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-10-3"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="merging-with-dplyr.html#solutions-10">12.5</a>.</p>
<ol style="list-style-type: decimal">
<li>Take the <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> tennis example, but now suppose that we want to keep only the matches in 2019 where <strong>either</strong> the winning player or the losing player had 10 or more match wins in 2018. How can you modify the code to achieve that goal?</li>
</ol>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tennis_2019_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tennis_2019_10</span><span class="op">$</span><span class="va">winner_name</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>* Take the <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> tennis example, but now suppose that we want to keep only the matches in 2019 where <strong>both</strong> the winning player and the losing player had 10 or more match wins in 2018. How can you modify the code to achieve that goal?</li>
</ol>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tennis_2019_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tennis_2019_10</span><span class="op">$</span><span class="va">winner_name</span></span></code></pre></div>
</div>
</div>
<div id="chapexercise-10" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Chapter Exercises<a class="anchor" aria-label="anchor" href="#chapexercise-10"><i class="fas fa-link"></i></a>
</h2>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="merging-with-dplyr.html#solutions-10">12.5</a>.</p>
<ol style="list-style-type: decimal">
<li>* Read in the gun violence data set, and suppose that you want to add a row to this data set that has the statistics on gun ownership and mortality rate in the District of Columbia (Washington D.C., which is in the NE region, has 16.7 deaths per 100,000 people, and a gun ownership rate of 8.7%). To do so, create a <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> that has a single row representing D.C. and then combine your new <code>tibble</code> with the overall gun violence data set. Name this new data set <code>all_df</code>.</li>
</ol>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">mortality_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/gun_violence_us.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Explain why each attempt at combining the D.C. data with the overall data doesn’t work or is incorrect.</li>
</ol>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="fl">16.7</span>,</span>
<span>                ownership_rate <span class="op">=</span> <span class="fl">8.7</span>, region <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">test1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="fl">16.7</span>,</span>
<span>       ownership_rate <span class="op">=</span> <span class="fl">0.087</span>, region <span class="op">=</span> <span class="va">NE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval_tidy(xs[[j]], mask): object 'NE' not found</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">test2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in list2(...): object 'test2' not found</span></span>
<span></span>
<span><span class="va">test3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="st">"16.7"</span>,</span>
<span>       ownership_rate <span class="op">=</span> <span class="st">"0.087"</span>, region <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">test3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `bind_rows()`:</span></span>
<span><span class="co">#&gt; ! Can't combine `mortality_rate` &lt;double&gt; and `mortality_rate` &lt;character&gt;.</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Examine the following data sets that are in <code>R</code>’s base library on demographic statistics about the U.S. states and state abbreviations:</li>
</ol>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">state.x77</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">state.abb</span><span class="op">)</span></span>
<span><span class="va">df1</span></span>
<span><span class="co">#&gt; # A tibble: 50 × 8</span></span>
<span><span class="co">#&gt;    Population Income Illiteracy Life …¹ Murder HS Gr…² Frost</span></span>
<span><span class="co">#&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1       3615   3624        2.1    69.0   15.1    41.3    20</span></span>
<span><span class="co">#&gt;  2        365   6315        1.5    69.3   11.3    66.7   152</span></span>
<span><span class="co">#&gt;  3       2212   4530        1.8    70.6    7.8    58.1    15</span></span>
<span><span class="co">#&gt;  4       2110   3378        1.9    70.7   10.1    39.9    65</span></span>
<span><span class="co">#&gt;  5      21198   5114        1.1    71.7   10.3    62.6    20</span></span>
<span><span class="co">#&gt;  6       2541   4884        0.7    72.1    6.8    63.9   166</span></span>
<span><span class="co">#&gt;  7       3100   5348        1.1    72.5    3.1    56     139</span></span>
<span><span class="co">#&gt;  8        579   4809        0.9    70.1    6.2    54.6   103</span></span>
<span><span class="co">#&gt;  9       8277   4815        1.3    70.7   10.7    52.6    11</span></span>
<span><span class="co">#&gt; 10       4931   4091        2      68.5   13.9    40.6    60</span></span>
<span><span class="co">#&gt; # … with 40 more rows, 1 more variable: Area &lt;dbl&gt;, and</span></span>
<span><span class="co">#&gt; #   abbreviated variable names ¹​`Life Exp`, ²​`HS Grad`</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span>
<span><span class="va">df2</span></span>
<span><span class="co">#&gt; # A tibble: 50 × 1</span></span>
<span><span class="co">#&gt;    value</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AL   </span></span>
<span><span class="co">#&gt;  2 AK   </span></span>
<span><span class="co">#&gt;  3 AZ   </span></span>
<span><span class="co">#&gt;  4 AR   </span></span>
<span><span class="co">#&gt;  5 CA   </span></span>
<span><span class="co">#&gt;  6 CO   </span></span>
<span><span class="co">#&gt;  7 CT   </span></span>
<span><span class="co">#&gt;  8 DE   </span></span>
<span><span class="co">#&gt;  9 FL   </span></span>
<span><span class="co">#&gt; 10 GA   </span></span>
<span><span class="co">#&gt; # … with 40 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Combine the two data sets with <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code>. What are you assuming about the data sets in order to use this function?</p>
<ol start="4" style="list-style-type: decimal">
<li><p>* Combine the columns of the states data set you made in Exercise 3 with the mortality data set <strong>without</strong> Washington D.C.</p></li>
<li><p>* Use a join function to combine the mortality data set (<code>all_df</code>) <strong>with</strong> D.C. with the states data set from Exercise 3 (<code>states_df</code>). For this exercise, keep the row with Washington D.C., having it take on <code>NA</code> values for any variable not observed in the states data.</p></li>
<li><p>* Repeat Exercise 5, but now drop Washington D.C. in your merging process. Practice doing this <strong>with a join function</strong> (as opposed to <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>-ing it out explicitly).</p></li>
<li><p>* Use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> to create a subset of <code>states_df</code> that are in the <code>NE</code> region. <strong>Hint</strong>: You will need to filter <code>all_df</code> first to contain only states in the <code>NE</code> region.</p></li>
<li><p>* Do the same thing as Exercise 7, but this time, use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>. <strong>Hint</strong>: You’ll need to filter <code>all_df</code> in a different way to achieve this.</p></li>
<li><p>Examine the following data sets (the first is <code>df1</code> and the second is <code>df2</code>) and then, without running any code, answer the following questions.</p></li>
</ol>
<div class="inline-table"><table style="width:17%;" class="table table-sm">
<colgroup>
<col width="6%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">id</th>
<th align="center">xvar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">A</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">B</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">C</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">E</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">F</td>
<td align="center">2</td>
</tr>
</tbody>
</table></div>
<div class="inline-table"><table style="width:17%;" class="table table-sm">
<colgroup>
<col width="6%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">id</th>
<th align="center">yvar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">A</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">C</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">D</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">E</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">G</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">H</td>
<td align="center">4</td>
</tr>
</tbody>
</table></div>
<ol style="list-style-type: lower-alpha">
<li><p>How many rows would be in the data set from <code>left_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>left_join(df2, df1, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>full_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>inner_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>semi_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>anti_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
</ol>
</div>
<div id="solutions-10" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> Exercise Solutions<a class="anchor" aria-label="anchor" href="#solutions-10"><i class="fas fa-link"></i></a>
</h2>
<div id="bind_rows-and-bind_cols-s" class="section level3" number="12.5.1">
<h3>
<span class="header-section-number">12.5.1</span> <code>bind_rows()</code> and <code>bind_cols()</code> S<a class="anchor" aria-label="anchor" href="#bind_rows-and-bind_cols-s"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>* Run the following and explain why <code>R</code> does not simply stack the rows. Then, fix the issue with the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function.</li>
</ol>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;    xvar  yvar     x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     5    NA    NA</span></span>
<span><span class="co">#&gt; 2     2     1    NA    NA</span></span>
<span><span class="co">#&gt; 3    NA    NA     1     5</span></span>
<span><span class="co">#&gt; 4    NA    NA     2     1</span></span></code></pre></div>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## This doesn't stack rows because the columns are named differently</span></span>
<span><span class="co">## in the two data sets. If xvar is the same variable as x and </span></span>
<span><span class="co">## yvar is the same variable as y, then we can rename the columns in</span></span>
<span><span class="co">## one of the data sets:</span></span>
<span></span>
<span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="va">df_test1a</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"xvar"</span>, y <span class="op">=</span> <span class="st">"yvar"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;       x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     5</span></span>
<span><span class="co">#&gt; 2     2     1</span></span>
<span><span class="co">#&gt; 3     1     5</span></span>
<span><span class="co">#&gt; 4     2     1</span></span></code></pre></div>
</div>
<div id="mutating-joins-s" class="section level3" number="12.5.2">
<h3>
<span class="header-section-number">12.5.2</span> Mutating Joins S<a class="anchor" aria-label="anchor" href="#mutating-joins-s"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="filtering-joins-s" class="section level3" number="12.5.3">
<h3>
<span class="header-section-number">12.5.3</span> Filtering Joins S<a class="anchor" aria-label="anchor" href="#filtering-joins-s"><i class="fas fa-link"></i></a>
</h3>
<ol start="2" style="list-style-type: decimal">
<li>* Take the <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> tennis example, but now suppose that we want to keep only the matches in 2019 where <strong>both</strong> the winning player and the losing player had 10 or more match wins in 2018. How can you modify the code to achieve that goal?</li>
</ol>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tennis_2019_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tennis_2019_10</span><span class="op">$</span><span class="va">winner_name</span></span></code></pre></div>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## There are many ways to do this, and this solution gives just one way</span></span>
<span><span class="co">## A first step would be to create a data set that keeps only</span></span>
<span><span class="co">## the katches with losing players with 10 or more wins in 2018</span></span>
<span><span class="va">tennis_2019_10_lose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"loser_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Using `bind_rows()` would result in many duplicate matches. A way</span></span>
<span><span class="co">## to avoid duplicates with joining functions is</span></span>
<span></span>
<span><span class="va">tennis_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">tennis_2019_10_lose</span>, <span class="va">tennis_2019_10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = c("tourney_id", "tourney_name", "surface",</span></span>
<span><span class="co">#&gt; "draw_size", "tourney_level", "tourney_date", "match_num",</span></span>
<span><span class="co">#&gt; "winner_id", "winner_seed", "winner_entry", "winner_name",</span></span>
<span><span class="co">#&gt; "winner_hand", "winner_ht", "winner_ioc", "winner_age",</span></span>
<span><span class="co">#&gt; "loser_id", "loser_seed", "loser_entry", "loser_name",</span></span>
<span><span class="co">#&gt; "loser_hand", "loser_ht", "loser_ioc", "loser_age",</span></span>
<span><span class="co">#&gt; "score", "best_of", "round", "minutes", "w_ace", "w_df",</span></span>
<span><span class="co">#&gt; "w_svpt", "w_1stIn", "w_1stWon", "w_2ndWon", "w_SvGms",</span></span>
<span><span class="co">#&gt; "w_bpSaved", "w_bpFaced", "l_ace", "l_df", "l_svpt",</span></span>
<span><span class="co">#&gt; "l_1stIn", "l_1stWon", "l_2ndWon", "l_SvGms", "l_bpSaved",</span></span>
<span><span class="co">#&gt; "l_bpFaced", "winner_rank", "winner_rank_points",</span></span>
<span><span class="co">#&gt; "loser_rank", "loser_rank_points")</span></span>
<span><span class="va">tennis_temp</span></span>
<span><span class="co">## there are 383 matches in the lose data set that aren't in the </span></span>
<span><span class="co">## win data set. Now, we can bind_rows():</span></span>
<span></span>
<span><span class="va">final_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">tennis_2019_10</span>, <span class="va">tennis_temp</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="chapexercise-10-S" class="section level3" number="12.5.4">
<h3>
<span class="header-section-number">12.5.4</span> Chapter Exercises S<a class="anchor" aria-label="anchor" href="#chapexercise-10-S"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>* Read in the gun violence data set, and suppose that you want to add a row to this data set that has the statistics on gun ownership and mortality rate in the District of Columbia (Washington D.C., which is in the NE region, has 16.7 deaths per 100,000 people, and a gun ownership rate of 8.7%). To do so, create a <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> that has a single row representing D.C. and then combine your new <code>tibble</code> with the overall gun violence data set. Name this new data set <code>all_df</code>.</li>
</ol>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">mortality_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/gun_violence_us.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 50 Columns: 4</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (2): state, region</span></span>
<span><span class="co">#&gt; dbl (2): mortality_rate, ownership_rate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre></div>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dc_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="fl">16.7</span>,</span>
<span>       ownership_rate <span class="op">=</span> <span class="fl">0.087</span>, region <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="va">all_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">dc_df</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>* Combine the columns of the states data set you made in Section A Exercise 3 with the mortality data set <strong>without</strong> Washington D.C.</li>
</ol>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">states_df</span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>* Use a join function to combine the mortality data set <strong>with</strong> D.C. with the states data set from Exercise 3. For this exercise, keep the row with Washington D.C., having it take on <code>NA</code> values for any variable not observed in the states data.</li>
</ol>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">all_df</span>, <span class="va">states_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 51 × 12</span></span>
<span><span class="co">#&gt;    state mortality_r…¹ owner…² region Popul…³ Income Illit…⁴</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 AL             16.7   0.489 South     3615   3624     2.1</span></span>
<span><span class="co">#&gt;  2 AK             18.8   0.617 West       365   6315     1.5</span></span>
<span><span class="co">#&gt;  3 AZ             13.4   0.323 West      2212   4530     1.8</span></span>
<span><span class="co">#&gt;  4 AR             16.4   0.579 South     2110   3378     1.9</span></span>
<span><span class="co">#&gt;  5 CA              7.4   0.201 West     21198   5114     1.1</span></span>
<span><span class="co">#&gt;  6 CO             12.1   0.343 West      2541   4884     0.7</span></span>
<span><span class="co">#&gt;  7 CT              4.9   0.166 NE        3100   5348     1.1</span></span>
<span><span class="co">#&gt;  8 DE             11.1   0.052 NE         579   4809     0.9</span></span>
<span><span class="co">#&gt;  9 FL             11.5   0.325 South     8277   4815     1.3</span></span>
<span><span class="co">#&gt; 10 GA             13.7   0.316 South     4931   4091     2  </span></span>
<span><span class="co">#&gt; # … with 41 more rows, 5 more variables: `Life Exp` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Murder &lt;dbl&gt;, `HS Grad` &lt;dbl&gt;, Frost &lt;dbl&gt;, Area &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   and abbreviated variable names ¹​mortality_rate,</span></span>
<span><span class="co">#&gt; #   ²​ownership_rate, ³​Population, ⁴​Illiteracy</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span>
<span><span class="co">## or</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">all_df</span>, <span class="va">states_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 51 × 12</span></span>
<span><span class="co">#&gt;    state mortality_r…¹ owner…² region Popul…³ Income Illit…⁴</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 AL             16.7   0.489 South     3615   3624     2.1</span></span>
<span><span class="co">#&gt;  2 AK             18.8   0.617 West       365   6315     1.5</span></span>
<span><span class="co">#&gt;  3 AZ             13.4   0.323 West      2212   4530     1.8</span></span>
<span><span class="co">#&gt;  4 AR             16.4   0.579 South     2110   3378     1.9</span></span>
<span><span class="co">#&gt;  5 CA              7.4   0.201 West     21198   5114     1.1</span></span>
<span><span class="co">#&gt;  6 CO             12.1   0.343 West      2541   4884     0.7</span></span>
<span><span class="co">#&gt;  7 CT              4.9   0.166 NE        3100   5348     1.1</span></span>
<span><span class="co">#&gt;  8 DE             11.1   0.052 NE         579   4809     0.9</span></span>
<span><span class="co">#&gt;  9 FL             11.5   0.325 South     8277   4815     1.3</span></span>
<span><span class="co">#&gt; 10 GA             13.7   0.316 South     4931   4091     2  </span></span>
<span><span class="co">#&gt; # … with 41 more rows, 5 more variables: `Life Exp` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Murder &lt;dbl&gt;, `HS Grad` &lt;dbl&gt;, Frost &lt;dbl&gt;, Area &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   and abbreviated variable names ¹​mortality_rate,</span></span>
<span><span class="co">#&gt; #   ²​ownership_rate, ³​Population, ⁴​Illiteracy</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>* Repeat Exercise 5, but now drop Washington D.C. in your merging process. Practice doing this <strong>with a join function</strong> (as opposed to <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> ing it out explictly).</li>
</ol>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">all_df</span>, <span class="va">states_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 50 × 12</span></span>
<span><span class="co">#&gt;    state mortality_r…¹ owner…² region Popul…³ Income Illit…⁴</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 AL             16.7   0.489 South     3615   3624     2.1</span></span>
<span><span class="co">#&gt;  2 AK             18.8   0.617 West       365   6315     1.5</span></span>
<span><span class="co">#&gt;  3 AZ             13.4   0.323 West      2212   4530     1.8</span></span>
<span><span class="co">#&gt;  4 AR             16.4   0.579 South     2110   3378     1.9</span></span>
<span><span class="co">#&gt;  5 CA              7.4   0.201 West     21198   5114     1.1</span></span>
<span><span class="co">#&gt;  6 CO             12.1   0.343 West      2541   4884     0.7</span></span>
<span><span class="co">#&gt;  7 CT              4.9   0.166 NE        3100   5348     1.1</span></span>
<span><span class="co">#&gt;  8 DE             11.1   0.052 NE         579   4809     0.9</span></span>
<span><span class="co">#&gt;  9 FL             11.5   0.325 South     8277   4815     1.3</span></span>
<span><span class="co">#&gt; 10 GA             13.7   0.316 South     4931   4091     2  </span></span>
<span><span class="co">#&gt; # … with 40 more rows, 5 more variables: `Life Exp` &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Murder &lt;dbl&gt;, `HS Grad` &lt;dbl&gt;, Frost &lt;dbl&gt;, Area &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   and abbreviated variable names ¹​mortality_rate,</span></span>
<span><span class="co">#&gt; #   ²​ownership_rate, ³​Population, ⁴​Illiteracy</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span>
<span><span class="co">## or</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">states_df</span>, <span class="va">all_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 50 × 12</span></span>
<span><span class="co">#&gt;    Population Income Illiteracy Life …¹ Murder HS Gr…² Frost</span></span>
<span><span class="co">#&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1       3615   3624        2.1    69.0   15.1    41.3    20</span></span>
<span><span class="co">#&gt;  2        365   6315        1.5    69.3   11.3    66.7   152</span></span>
<span><span class="co">#&gt;  3       2212   4530        1.8    70.6    7.8    58.1    15</span></span>
<span><span class="co">#&gt;  4       2110   3378        1.9    70.7   10.1    39.9    65</span></span>
<span><span class="co">#&gt;  5      21198   5114        1.1    71.7   10.3    62.6    20</span></span>
<span><span class="co">#&gt;  6       2541   4884        0.7    72.1    6.8    63.9   166</span></span>
<span><span class="co">#&gt;  7       3100   5348        1.1    72.5    3.1    56     139</span></span>
<span><span class="co">#&gt;  8        579   4809        0.9    70.1    6.2    54.6   103</span></span>
<span><span class="co">#&gt;  9       8277   4815        1.3    70.7   10.7    52.6    11</span></span>
<span><span class="co">#&gt; 10       4931   4091        2      68.5   13.9    40.6    60</span></span>
<span><span class="co">#&gt; # … with 40 more rows, 5 more variables: Area &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   value &lt;chr&gt;, mortality_rate &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   ownership_rate &lt;dbl&gt;, region &lt;chr&gt;, and abbreviated</span></span>
<span><span class="co">#&gt; #   variable names ¹​`Life Exp`, ²​`HS Grad`</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>* Use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> to create a subset of <code>states_df</code> that are in the <code>NE</code> region. <strong>Hint</strong>: You will need to filter <code>all_df</code> first to contain only states in the <code>NE</code> region.</li>
</ol>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ne_df</span> <span class="op">&lt;-</span> <span class="va">all_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">states_df</span>, <span class="va">ne_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 9</span></span>
<span><span class="co">#&gt;    Popul…¹ Income Illit…² Life …³ Murder HS Gr…⁴ Frost  Area</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1    3100   5348     1.1    72.5    3.1    56     139  4862</span></span>
<span><span class="co">#&gt;  2     579   4809     0.9    70.1    6.2    54.6   103  1982</span></span>
<span><span class="co">#&gt;  3    1058   3694     0.7    70.4    2.7    54.7   161 30920</span></span>
<span><span class="co">#&gt;  4    4122   5299     0.9    70.2    8.5    52.3   101  9891</span></span>
<span><span class="co">#&gt;  5    5814   4755     1.1    71.8    3.3    58.5   103  7826</span></span>
<span><span class="co">#&gt;  6     812   4281     0.7    71.2    3.3    57.6   174  9027</span></span>
<span><span class="co">#&gt;  7    7333   5237     1.1    70.9    5.2    52.5   115  7521</span></span>
<span><span class="co">#&gt;  8   18076   4903     1.4    70.6   10.9    52.7    82 47831</span></span>
<span><span class="co">#&gt;  9     931   4558     1.3    71.9    2.4    46.4   127  1049</span></span>
<span><span class="co">#&gt; 10     472   3907     0.6    71.6    5.5    57.1   168  9267</span></span>
<span><span class="co">#&gt; # … with 1 more variable: value &lt;chr&gt;, and abbreviated</span></span>
<span><span class="co">#&gt; #   variable names ¹​Population, ²​Illiteracy, ³​`Life Exp`,</span></span>
<span><span class="co">#&gt; #   ⁴​`HS Grad`</span></span>
<span><span class="co">#&gt; # ℹ Use `colnames()` to see all variable names</span></span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>* Do the same thing as Exercise 7, but this time, use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>. <strong>Hint</strong>: You’ll need to filter <code>all_df</code> in a different way to achieve this.</li>
</ol>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">notne_df</span> <span class="op">&lt;-</span> <span class="va">all_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">!=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">states_df</span>, <span class="va">notne_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 9</span></span>
<span><span class="co">#&gt;    Popul…¹ Income Illit…² Life …³ Murder HS Gr…⁴ Frost  Area</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1    3100   5348     1.1    72.5    3.1    56     139  4862</span></span>
<span><span class="co">#&gt;  2     579   4809     0.9    70.1    6.2    54.6   103  1982</span></span>
<span><span class="co">#&gt;  3    1058   3694     0.7    70.4    2.7    54.7   161 30920</span></span>
<span><span class="co">#&gt;  4    4122   5299     0.9    70.2    8.5    52.3   101  9891</span></span>
<span><span class="co">#&gt;  5    5814   4755     1.1    71.8    3.3    58.5   103  7826</span></span>
<span><span class="co">#&gt;  6     812   4281     0.7    71.2    3.3    57.6   174  9027</span></span>
<span><span class="co">#&gt;  7    7333   5237     1.1    70.9    5.2    52.5   115  7521</span></span>
<span><span class="co">#&gt;  8   18076   4903     1.4    70.6   10.9    52.7    82 47831</span></span>
<span><span class="co">#&gt;  9     931   4558     1.3    71.9    2.4    46.4   127  1049</span></span>
<span><span class="co">#&gt; 10     472   3907     0.6    71.6    5.5    57.1   168  9267</span></span>
<span><span class="co">#&gt; # … with 1 more variable: value &lt;chr&gt;, and abbreviated</span></span>
<span><span class="co">#&gt; #   variable names ¹​Population, ²​Illiteracy, ³​`Life Exp`,</span></span>
<span><span class="co">#&gt; #   ⁴​`HS Grad`</span></span>
<span><span class="co">#&gt; # ℹ Use `colnames()` to see all variable names</span></span></code></pre></div>
</div>
</div>
<div id="rcode-10" class="section level2" number="12.6">
<h2>
<span class="header-section-number">12.6</span> Non-Exercise <code>R</code> Code<a class="anchor" aria-label="anchor" href="#rcode-10"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="va">atp_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2019.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">atp_2019</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">atp_2018</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/spec.html">spec</a></span><span class="op">(</span><span class="va">atp_2018</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span>,</span>
<span>                     col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>winner_seed <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                      loser_seed <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">atp_2018</span>, <span class="va">atp_2019</span><span class="op">)</span></span>
<span><span class="va">atp_df</span></span>
<span><span class="va">df_test2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test2a</span>, <span class="va">df_test2b</span><span class="op">)</span></span>
<span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>, <span class="st">"Miguel"</span>, <span class="st">"Tonya"</span><span class="op">)</span>, fav_sport <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Swimming"</span>, <span class="st">"Football"</span>, <span class="st">"Tennis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tonya"</span>, <span class="st">"Miguel"</span>, <span class="st">"Emily"</span><span class="op">)</span>,</span>
<span>              fav_colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Robin's Egg Blue"</span>, <span class="st">"Tickle Me Pink"</span>, <span class="st">"Goldenrod"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##install.packages("babynames")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span></span>
<span><span class="va">life_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/lifetables.html">lifetables</a></span></span>
<span><span class="va">birth_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/births.html">births</a></span></span>
<span><span class="va">babynames_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/babynames.html">babynames</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">babynames</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">births</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lifetables</span><span class="op">)</span></span>
<span><span class="va">combined_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">combined_left</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">combined_left</span><span class="op">)</span></span>
<span><span class="co">## these will always do the same exact thing</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">birth_df</span>, <span class="va">babynames_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">slumajors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/SLU_Majors_15_19.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">collegemajors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/college-majors.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">slumajors_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">collegemajors_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">slumajors_df</span>, <span class="va">collegemajors_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major"</span> <span class="op">=</span> <span class="st">"Major"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">collegemajors_df</span> <span class="op">&lt;-</span> <span class="va">collegemajors_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Major <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">Major</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">slumajors_df</span>, <span class="va">collegemajors_df</span><span class="op">)</span></span>
<span><span class="va">atp_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2019.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2019</span></span>
<span><span class="va">atp_2018</span></span>
<span><span class="va">win10</span> <span class="op">&lt;-</span> <span class="va">atp_2018</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">winner_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nwin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nwin</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">win10</span></span>
<span><span class="va">tennis_2019_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tennis_2019_10</span><span class="op">$</span><span class="va">winner_name</span></span>
<span><span class="va">new_winners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">atp_2018</span>,</span>
<span>                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">new_winners</span><span class="op">$</span><span class="va">winner_name</span></span>
<span><span class="va">new_winners</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">winner_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nwin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">nwin</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="data-import.html"><span class="header-section-number">11</span> Data Import</a></div>
<div class="next"><a href="dates-with-lubridate.html"><span class="header-section-number">13</span> Dates with lubridate</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#merging-with-dplyr"><span class="header-section-number">12</span> Merging with dplyr</a></li>
<li>
<a class="nav-link" href="#stacking-rows-and-appending-columns"><span class="header-section-number">12.1</span> Stacking Rows and Appending Columns</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#stacking-with-bind_rows"><span class="header-section-number">12.1.1</span> Stacking with bind_rows()</a></li>
<li><a class="nav-link" href="#binding-columns-with-bind_cols"><span class="header-section-number">12.1.2</span> Binding Columns with bind_cols()</a></li>
<li><a class="nav-link" href="#exercise-10-1"><span class="header-section-number">12.1.3</span> Exercises</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#mutating-joins"><span class="header-section-number">12.2</span> Mutating Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#keep-all-rows-of-data-set-1-with-left_join"><span class="header-section-number">12.2.1</span> Keep All Rows of Data Set 1 with left_join()</a></li>
<li><a class="nav-link" href="#keep-all-rows-of-data-set-2-with-right_join"><span class="header-section-number">12.2.2</span> Keep All Rows of Data Set 2 with right_join()</a></li>
<li><a class="nav-link" href="#keep-all-rows-of-both-data-sets-with-full_join"><span class="header-section-number">12.2.3</span> Keep All Rows of Both Data Sets with full_join()</a></li>
<li><a class="nav-link" href="#keep-only-rows-with-matching-keys-with-inner_join"><span class="header-section-number">12.2.4</span> Keep Only Rows with Matching Keys with inner_join()</a></li>
<li><a class="nav-link" href="#which-xxxx_join"><span class="header-section-number">12.2.5</span> Which xxxx_join()?</a></li>
<li><a class="nav-link" href="#the-importance-of-a-good-key"><span class="header-section-number">12.2.6</span> The Importance of a Good Key</a></li>
<li><a class="nav-link" href="#exercise-10-2"><span class="header-section-number">12.2.7</span> Exercises</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filtering-joins"><span class="header-section-number">12.3</span> Filtering Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filtering-with-semi_join"><span class="header-section-number">12.3.1</span> Filtering with semi_join()</a></li>
<li><a class="nav-link" href="#filtering-with-anti_join"><span class="header-section-number">12.3.2</span> Filtering with anti_join()</a></li>
<li><a class="nav-link" href="#exercise-10-3"><span class="header-section-number">12.3.3</span> Exercises</a></li>
</ul>
</li>
<li><a class="nav-link" href="#chapexercise-10"><span class="header-section-number">12.4</span> Chapter Exercises</a></li>
<li>
<a class="nav-link" href="#solutions-10"><span class="header-section-number">12.5</span> Exercise Solutions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bind_rows-and-bind_cols-s"><span class="header-section-number">12.5.1</span> bind_rows() and bind_cols() S</a></li>
<li><a class="nav-link" href="#mutating-joins-s"><span class="header-section-number">12.5.2</span> Mutating Joins S</a></li>
<li><a class="nav-link" href="#filtering-joins-s"><span class="header-section-number">12.5.3</span> Filtering Joins S</a></li>
<li><a class="nav-link" href="#chapexercise-10-S"><span class="header-section-number">12.5.4</span> Chapter Exercises S</a></li>
</ul>
</li>
<li><a class="nav-link" href="#rcode-10"><span class="header-section-number">12.6</span> Non-Exercise R Code</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT 234: Data Science</strong>" was written by Matt Higham. It was last built on 2022-09-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
