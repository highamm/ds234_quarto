<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>DATA / STAT 234 - 11&nbsp; Merging with dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-lubridate.html" rel="next">
<link href="./08-import.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-tidyr.html">Data Wrangling</a></li><li class="breadcrumb-item"><a href="./10-merging.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merging with `dplyr`</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DATA / STAT 234</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus and Course Information</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">The Core</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Plotting with <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Wrangling with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-comm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Communication with <code>Quarto</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Workflow and Other Skills</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tidying with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Coding in Base <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-forcats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Factors with <code>forcats</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Ethics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-merging.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merging with <code>dplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Special Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-lubridate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dates with <code>lubridate</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-stringr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text Data with <code>tidytext</code> and <code>stringr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Predictive Modeling with knn</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-connections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Connections to STAT 113, STAT 213, and CS 140</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction to SQL with <code>dbplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#stacking-rows-and-appending-columns" id="toc-stacking-rows-and-appending-columns" class="nav-link active" data-scroll-target="#stacking-rows-and-appending-columns"><span class="header-section-number">11.1</span> Stacking Rows and Appending Columns</a>
  <ul class="collapse">
<li><a href="#stacking-with-bind_rows" id="toc-stacking-with-bind_rows" class="nav-link" data-scroll-target="#stacking-with-bind_rows"><span class="header-section-number">11.1.1</span> Stacking with <code>bind_rows()</code></a></li>
  <li><a href="#binding-columns-with-bind_cols" id="toc-binding-columns-with-bind_cols" class="nav-link" data-scroll-target="#binding-columns-with-bind_cols"><span class="header-section-number">11.1.2</span> Binding Columns with <code>bind_cols()</code></a></li>
  </ul>
</li>
  <li>
<a href="#mutating-joins" id="toc-mutating-joins" class="nav-link" data-scroll-target="#mutating-joins"><span class="header-section-number">11.2</span> Mutating Joins</a>
  <ul class="collapse">
<li><a href="#keep-all-rows-of-data-set-1-with-left_join" id="toc-keep-all-rows-of-data-set-1-with-left_join" class="nav-link" data-scroll-target="#keep-all-rows-of-data-set-1-with-left_join"><span class="header-section-number">11.2.1</span> Keep All Rows of Data Set 1 with <code>left_join()</code></a></li>
  <li><a href="#keep-all-rows-of-data-set-2-with-right_join" id="toc-keep-all-rows-of-data-set-2-with-right_join" class="nav-link" data-scroll-target="#keep-all-rows-of-data-set-2-with-right_join"><span class="header-section-number">11.2.2</span> Keep All Rows of Data Set 2 with <code>right_join()</code></a></li>
  <li><a href="#keep-all-rows-of-both-data-sets-with-full_join" id="toc-keep-all-rows-of-both-data-sets-with-full_join" class="nav-link" data-scroll-target="#keep-all-rows-of-both-data-sets-with-full_join"><span class="header-section-number">11.2.3</span> Keep All Rows of Both Data Sets with <code>full_join()</code></a></li>
  <li><a href="#keep-only-rows-with-matching-keys-with-inner_join" id="toc-keep-only-rows-with-matching-keys-with-inner_join" class="nav-link" data-scroll-target="#keep-only-rows-with-matching-keys-with-inner_join"><span class="header-section-number">11.2.4</span> Keep Only Rows with Matching Keys with <code>inner_join()</code></a></li>
  <li><a href="#which-xxxx_join" id="toc-which-xxxx_join" class="nav-link" data-scroll-target="#which-xxxx_join"><span class="header-section-number">11.2.5</span> Which <code>xxxx_join()</code>?</a></li>
  </ul>
</li>
  <li>
<a href="#filtering-joins" id="toc-filtering-joins" class="nav-link" data-scroll-target="#filtering-joins"><span class="header-section-number">11.3</span> Filtering Joins</a>
  <ul class="collapse">
<li><a href="#filtering-with-semi_join" id="toc-filtering-with-semi_join" class="nav-link" data-scroll-target="#filtering-with-semi_join"><span class="header-section-number">11.3.1</span> Filtering with <code>semi_join()</code></a></li>
  <li><a href="#filtering-with-anti_join" id="toc-filtering-with-anti_join" class="nav-link" data-scroll-target="#filtering-with-anti_join"><span class="header-section-number">11.3.2</span> Filtering with <code>anti_join()</code></a></li>
  </ul>
</li>
  <li>
<a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">11.4</span> Practice</a>
  <ul class="collapse">
<li><a href="#class-exercises" id="toc-class-exercises" class="nav-link" data-scroll-target="#class-exercises"><span class="header-section-number">11.4.1</span> Class Exercises</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><span class="header-section-number">11.4.2</span> Your Turn</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="merging" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merging with <code>dplyr</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><strong>Goals:</strong></p>
<ul>
<li><p>use <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> to stack two data sets and <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> to merge two data sets.</p></li>
<li><p>identify <strong>keys</strong> in two related data sets.</p></li>
<li><p>use the mutating join functions in <code>dplyr</code> to merge two data sets by a key.</p></li>
<li><p>use the filtering join functions in <code>dplyr</code> to filter one data set by values in another data set.</p></li>
<li><p>apply the appropriate <code>join()</code> function for a given problem and context.</p></li>
</ul>
<section id="stacking-rows-and-appending-columns" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="stacking-rows-and-appending-columns">
<span class="header-section-number">11.1</span> Stacking Rows and Appending Columns</h2>
<section id="stacking-with-bind_rows" class="level3" data-number="11.1.1"><h3 data-number="11.1.1" class="anchored" data-anchor-id="stacking-with-bind_rows">
<span class="header-section-number">11.1.1</span> Stacking with <code>bind_rows()</code>
</h3>
<p>First, we will talk about combining two data sets by “stacking” them on top of each other to form one new data set. The <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> function can be used for this purpose <strong>if</strong> the two data sets have identical column names.</p>
<p>A common instance where this is useful is if two data sets come from the same source and have different locations or years, but the same exact column names.</p>
<p>For example, examine the following website and notice how there are .csv files given for each year of matches in the ATP (Association of (men’s) Tennis Professionals). <a href="https://github.com/JeffSackmann/tennis_atp" target="_blank">https://github.com/JeffSackmann/tennis_atp</a>.</p>
<p>Then, read in the data sets, and look at how many columns each has.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="va">atp_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2019.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">atp_2019</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">atp_2018</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To combine results from both data sets,</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">atp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">atp_2018</span>, <span class="va">atp_2019</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `bind_rows()`:</span></span>
<span><span class="co">#&gt; ! Can't combine `..1$winner_seed` &lt;double&gt; and `..2$winner_seed` &lt;character&gt;.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The issue is that the <code>winner_seed</code> and <code>loser_seed</code> variables are of different variable classes in the <code>atp_2018</code> data vs.&nbsp;the <code>atp_2019</code> data. The following code forces the seed variables in the 2018 data set to be characters.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span>,</span>
<span>                     col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>winner_seed <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                      loser_seed <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can try combining the data sets now.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">atp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">atp_2018</span>, <span class="va">atp_2019</span><span class="op">)</span></span>
<span><span class="va">atp_df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Do a quick check to make sure the number of rows in <code>atp_2018</code> plus the number of rows in <code>atp_2019</code> equals the number of rows in <code>atp_df</code>.</p>
<p>It might seem a little annoying, but, by default <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> will only combine two data sets by stacking rows if the data sets have <strong>identical</strong> column names and <strong>identical</strong> column classes, as we saw in the previous example.</p>
<p>Now run the following and look at the output.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_test2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test2a</span>, <span class="va">df_test2b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;    xvar     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    NA</span></span>
<span><span class="co">#&gt; 2     2    NA</span></span>
<span><span class="co">#&gt; 3     1     5</span></span>
<span><span class="co">#&gt; 4     2     1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see from this toy example that, if a variable is missing entirely in one of the data sets we are binding together, then <code>NA</code> values are filled in for that variable.</p>
</section><section id="binding-columns-with-bind_cols" class="level3" data-number="11.1.2"><h3 data-number="11.1.2" class="anchored" data-anchor-id="binding-columns-with-bind_cols">
<span class="header-section-number">11.1.2</span> Binding Columns with <code>bind_cols()</code>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> combines two data sets by combining their columns into one data set. We won’t spend much time talking about how to bind together columns because it’s generally a little dangerous.</p>
<p>We will use a couple of test data sets, <code>df_test1a</code> and <code>df_test1b</code>, to see it in action:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;    xvar  yvar     x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     5     1     5</span></span>
<span><span class="co">#&gt; 2     2     1     2     1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Exercise 1</strong>. Run the following and explain why <code>R</code> does not simply stack the rows. Then, fix the issue with the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_test1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, yvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_test1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">df_test1a</span>, <span class="va">df_test1b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;    xvar  yvar     x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     5    NA    NA</span></span>
<span><span class="co">#&gt; 2     2     1    NA    NA</span></span>
<span><span class="co">#&gt; 3    NA    NA     1     5</span></span>
<span><span class="co">#&gt; 4    NA    NA     2     1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="mutating-joins" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="mutating-joins">
<span class="header-section-number">11.2</span> Mutating Joins</h2>
<p>If the goal is to combine two data sets using some common variable(s) that both data sets have, we need different tools than simply stacking rows or appending columns. When merging together two or more data sets, we need to have a matching identification variable in each data set. This variable is commonly called a <strong>key</strong>. A key can be an identification number, a name, a date, etc, but must be present in both data sets.</p>
<p>As a simple first example, consider</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Emily"</span>, <span class="st">"Miguel"</span>, <span class="st">"Tonya"</span><span class="op">)</span>, fav_sport <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Swimming"</span>, <span class="st">"Football"</span>, <span class="st">"Tennis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tonya"</span>, <span class="st">"Miguel"</span>, <span class="st">"Emily"</span><span class="op">)</span>,</span>
<span>              fav_colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Robin's Egg Blue"</span>, <span class="st">"Tickle Me Pink"</span>, <span class="st">"Goldenrod"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our goal is to combine the two data sets so that the people’s favorite sports and favorite colours are in one data set.</p>
<p>Identify the <code>key</code> in the example above.</p>
<section id="keep-all-rows-of-data-set-1-with-left_join" class="level3" data-number="11.2.1"><h3 data-number="11.2.1" class="anchored" data-anchor-id="keep-all-rows-of-data-set-1-with-left_join">
<span class="header-section-number">11.2.1</span> Keep All Rows of Data Set 1 with <code>left_join()</code>
</h3>
<p>Consider the <code>babynames</code> <code>R</code> package, which has the following data sets:</p>
<ul>
<li>
<code>lifetables</code>: cohort life tables for different <code>sex</code> and different <code>year</code> variables, starting at the year 1900.</li>
<li>
<code>births</code>: the number of births in the United States in each year, since 1909</li>
<li>
<code>babynames</code>: popularity of different baby names per year and sex since the year 1880.</li>
</ul>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">##install.packages("babynames")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span></span>
<span><span class="va">life_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/lifetables.html">lifetables</a></span></span>
<span><span class="va">birth_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/births.html">births</a></span></span>
<span><span class="va">babynames_df</span> <span class="op">&lt;-</span> <span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/babynames.html">babynames</a></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">babynames</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">births</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lifetables</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read about each data set with <code><a href="https://rdrr.io/pkg/babynames/man/babynames.html">?babynames</a></code>, <code><a href="https://rdrr.io/pkg/babynames/man/births.html">?births</a></code> and <code><a href="https://rdrr.io/pkg/babynames/man/lifetables.html">?lifetables</a></code>.</p>
<p>Suppose that you want to combine the <code>births</code> data set with the <code>babynames</code> data set, so that each row of <code>babynames</code> now has the total number of births for that year. We first need to identify the key in each data set that we will use for the joining. In this case, each data set has a <code>year</code> variable, and we can use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> to keep all observations in <code>babynames_df</code>, even for years that are not in the <code>births_df</code> data set.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">combined_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">combined_left</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;    year sex   name          n   prop births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  1880 F     Mary       7065 0.0724     NA</span></span>
<span><span class="co">#&gt; 2  1880 F     Anna       2604 0.0267     NA</span></span>
<span><span class="co">#&gt; 3  1880 F     Emma       2003 0.0205     NA</span></span>
<span><span class="co">#&gt; 4  1880 F     Elizabeth  1939 0.0199     NA</span></span>
<span><span class="co">#&gt; 5  1880 F     Minnie     1746 0.0179     NA</span></span>
<span><span class="co">#&gt; 6  1880 F     Margaret   1578 0.0162     NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">combined_left</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;    year sex   name       n       prop  births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2017 M     Zyhier     5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 2  2017 M     Zykai      5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 3  2017 M     Zykeem     5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 4  2017 M     Zylin      5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 5  2017 M     Zylis      5 0.00000255 3855500</span></span>
<span><span class="co">#&gt; 6  2017 M     Zyrie      5 0.00000255 3855500</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Why are <code>births</code> missing in <code>head(combined_left)</code> but not in <code>tail(combined_left)</code>?</p>
</section><section id="keep-all-rows-of-data-set-2-with-right_join" class="level3" data-number="11.2.2"><h3 data-number="11.2.2" class="anchored" data-anchor-id="keep-all-rows-of-data-set-2-with-right_join">
<span class="header-section-number">11.2.2</span> Keep All Rows of Data Set 2 with <code>right_join()</code>
</h3>
<p>Recall from the accompanying handout that there is no need to ever use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> because it is the same as using a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> with the first two data set arguments switched:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## these will always do the same exact thing</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;    year sex   name         n   prop  births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  1909 F     Mary     19259 0.0523 2718000</span></span>
<span><span class="co">#&gt; 2  1909 F     Helen     9250 0.0251 2718000</span></span>
<span><span class="co">#&gt; 3  1909 F     Margaret  7359 0.0200 2718000</span></span>
<span><span class="co">#&gt; 4  1909 F     Ruth      6509 0.0177 2718000</span></span>
<span><span class="co">#&gt; 5  1909 F     Dorothy   6253 0.0170 2718000</span></span>
<span><span class="co">#&gt; 6  1909 F     Anna      5804 0.0158 2718000</span></span>
<span><span class="co">#&gt; # ℹ 1,839,946 more rows</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">birth_df</span>, <span class="va">babynames_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;    year  births sex   name         n   prop</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  1909 2718000 F     Mary     19259 0.0523</span></span>
<span><span class="co">#&gt; 2  1909 2718000 F     Helen     9250 0.0251</span></span>
<span><span class="co">#&gt; 3  1909 2718000 F     Margaret  7359 0.0200</span></span>
<span><span class="co">#&gt; 4  1909 2718000 F     Ruth      6509 0.0177</span></span>
<span><span class="co">#&gt; 5  1909 2718000 F     Dorothy   6253 0.0170</span></span>
<span><span class="co">#&gt; 6  1909 2718000 F     Anna      5804 0.0158</span></span>
<span><span class="co">#&gt; # ℹ 1,839,946 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Therefore, it’s usually easier to just always use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> and ignore <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> completely.</p>
</section><section id="keep-all-rows-of-both-data-sets-with-full_join" class="level3" data-number="11.2.3"><h3 data-number="11.2.3" class="anchored" data-anchor-id="keep-all-rows-of-both-data-sets-with-full_join">
<span class="header-section-number">11.2.3</span> Keep All Rows of Both Data Sets with <code>full_join()</code>
</h3>
<p>In addition to keeping any rows with a matching key in the other data frame, a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> will keep all rows in data set 1 that don’t have a matching key in data set 2, and will also keep all rows in data set 2 that don’t have a matching key in data set 1, filling in <code>NA</code> for missing values when necessary. For our example of merging <code>babynames_df</code> with <code>birth_df</code>,</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="keep-only-rows-with-matching-keys-with-inner_join" class="level3" data-number="11.2.4"><h3 data-number="11.2.4" class="anchored" data-anchor-id="keep-only-rows-with-matching-keys-with-inner_join">
<span class="header-section-number">11.2.4</span> Keep Only Rows with Matching Keys with <code>inner_join()</code>
</h3>
<p>We can also keep only rows with matching keys with <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>. For this join, any row in data set 1 without a matching key in data set 2 is dropped, and any row in data set 2 without a matching key in data set 1 is also dropped.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;    year sex   name         n   prop  births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  1909 F     Mary     19259 0.0523 2718000</span></span>
<span><span class="co">#&gt; 2  1909 F     Helen     9250 0.0251 2718000</span></span>
<span><span class="co">#&gt; 3  1909 F     Margaret  7359 0.0200 2718000</span></span>
<span><span class="co">#&gt; 4  1909 F     Ruth      6509 0.0177 2718000</span></span>
<span><span class="co">#&gt; 5  1909 F     Dorothy   6253 0.0170 2718000</span></span>
<span><span class="co">#&gt; 6  1909 F     Anna      5804 0.0158 2718000</span></span>
<span><span class="co">#&gt; # ℹ 1,839,946 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section><section id="which-xxxx_join" class="level3" data-number="11.2.5"><h3 data-number="11.2.5" class="anchored" data-anchor-id="which-xxxx_join">
<span class="header-section-number">11.2.5</span> Which <code>xxxx_join()</code>?</h3>
<p>Which join function we use will depend on the context of the data and what questions you will be answering in your analysis.</p>
<div class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re using a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, you’re potentially cutting out some data. It’s important to be aware of what data you’re omitting. For example, with the <code>babynames</code> and <code>births</code> data, we would want to keep a note that a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> removed all observations before 1909 from joined data set.</p>
</div>
</div>
<p><strong>Exercise 2</strong>. Examine the following two joins that we’ve done, and explain why one resulting data set has fewer observations (rows) than the other.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">babynames_df</span>, <span class="va">birth_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,924,665 × 6</span></span>
<span><span class="co">#&gt;    year sex   name          n   prop births</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  1880 F     Mary       7065 0.0724     NA</span></span>
<span><span class="co">#&gt; 2  1880 F     Anna       2604 0.0267     NA</span></span>
<span><span class="co">#&gt; 3  1880 F     Emma       2003 0.0205     NA</span></span>
<span><span class="co">#&gt; 4  1880 F     Elizabeth  1939 0.0199     NA</span></span>
<span><span class="co">#&gt; 5  1880 F     Minnie     1746 0.0179     NA</span></span>
<span><span class="co">#&gt; 6  1880 F     Margaret   1578 0.0162     NA</span></span>
<span><span class="co">#&gt; # ℹ 1,924,659 more rows</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">birth_df</span>, <span class="va">babynames_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,839,952 × 6</span></span>
<span><span class="co">#&gt;    year  births sex   name         n   prop</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  1909 2718000 F     Mary     19259 0.0523</span></span>
<span><span class="co">#&gt; 2  1909 2718000 F     Helen     9250 0.0251</span></span>
<span><span class="co">#&gt; 3  1909 2718000 F     Margaret  7359 0.0200</span></span>
<span><span class="co">#&gt; 4  1909 2718000 F     Ruth      6509 0.0177</span></span>
<span><span class="co">#&gt; 5  1909 2718000 F     Dorothy   6253 0.0170</span></span>
<span><span class="co">#&gt; 6  1909 2718000 F     Anna      5804 0.0158</span></span>
<span><span class="co">#&gt; # ℹ 1,839,946 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="filtering-joins" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="filtering-joins">
<span class="header-section-number">11.3</span> Filtering Joins</h2>
<p>Filtering joins (<code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>) are useful if we would only like to keep the variables in one data set, but we want to filter out observations by a variable in the second data set.</p>
<p>Consider again the two data sets on men’s tennis matches in 2018 and in 2019.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">atp_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2019.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/atp_matches_2018.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">atp_2019</span></span>
<span><span class="co">#&gt; # A tibble: 2,781 × 49</span></span>
<span><span class="co">#&gt;   tourney_id tourney_name surface draw_size tourney_level tourney_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2019-M020  Brisbane     Hard           32 A                 20181231</span></span>
<span><span class="co">#&gt; 2 2019-M020  Brisbane     Hard           32 A                 20181231</span></span>
<span><span class="co">#&gt; 3 2019-M020  Brisbane     Hard           32 A                 20181231</span></span>
<span><span class="co">#&gt; 4 2019-M020  Brisbane     Hard           32 A                 20181231</span></span>
<span><span class="co">#&gt; 5 2019-M020  Brisbane     Hard           32 A                 20181231</span></span>
<span><span class="co">#&gt; 6 2019-M020  Brisbane     Hard           32 A                 20181231</span></span>
<span><span class="co">#&gt; # ℹ 2,775 more rows</span></span>
<span><span class="co">#&gt; # ℹ 43 more variables: match_num &lt;dbl&gt;, winner_id &lt;dbl&gt;, winner_seed &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   winner_entry &lt;chr&gt;, winner_name &lt;chr&gt;, winner_hand &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   winner_ht &lt;dbl&gt;, winner_ioc &lt;chr&gt;, winner_age &lt;dbl&gt;, loser_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   loser_seed &lt;chr&gt;, loser_entry &lt;chr&gt;, loser_name &lt;chr&gt;, loser_hand &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   loser_ht &lt;dbl&gt;, loser_ioc &lt;chr&gt;, loser_age &lt;dbl&gt;, score &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   best_of &lt;dbl&gt;, round &lt;chr&gt;, minutes &lt;dbl&gt;, w_ace &lt;dbl&gt;, w_df &lt;dbl&gt;, …</span></span>
<span><span class="va">atp_2018</span></span>
<span><span class="co">#&gt; # A tibble: 2,889 × 49</span></span>
<span><span class="co">#&gt;   tourney_id tourney_name surface draw_size tourney_level tourney_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2018-M020  Brisbane     Hard           32 A                 20180101</span></span>
<span><span class="co">#&gt; 2 2018-M020  Brisbane     Hard           32 A                 20180101</span></span>
<span><span class="co">#&gt; 3 2018-M020  Brisbane     Hard           32 A                 20180101</span></span>
<span><span class="co">#&gt; 4 2018-M020  Brisbane     Hard           32 A                 20180101</span></span>
<span><span class="co">#&gt; 5 2018-M020  Brisbane     Hard           32 A                 20180101</span></span>
<span><span class="co">#&gt; 6 2018-M020  Brisbane     Hard           32 A                 20180101</span></span>
<span><span class="co">#&gt; # ℹ 2,883 more rows</span></span>
<span><span class="co">#&gt; # ℹ 43 more variables: match_num &lt;dbl&gt;, winner_id &lt;dbl&gt;, winner_seed &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   winner_entry &lt;chr&gt;, winner_name &lt;chr&gt;, winner_hand &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   winner_ht &lt;dbl&gt;, winner_ioc &lt;chr&gt;, winner_age &lt;dbl&gt;, loser_id &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   loser_seed &lt;dbl&gt;, loser_entry &lt;chr&gt;, loser_name &lt;chr&gt;, loser_hand &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   loser_ht &lt;dbl&gt;, loser_ioc &lt;chr&gt;, loser_age &lt;dbl&gt;, score &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   best_of &lt;dbl&gt;, round &lt;chr&gt;, minutes &lt;dbl&gt;, w_ace &lt;dbl&gt;, w_df &lt;dbl&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="filtering-with-semi_join" class="level3" data-number="11.3.1"><h3 data-number="11.3.1" class="anchored" data-anchor-id="filtering-with-semi_join">
<span class="header-section-number">11.3.1</span> Filtering with <code>semi_join()</code>
</h3>
<p>Suppose that we only want to keep matches in 2019 where the winning player had 10 or more wins in 2018. This might be useful if we want to not consider players in 2018 that only played in a couple of matches, perhaps because they got injured or perhaps because they received a special wildcard into the draw of only one event.</p>
<p>To accomplish this, we can first create a data set that has the names of all of the players that won 10 or more matches in 2018, using functions that we learned from <code>dplyr</code> earlier in the semester:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">win10</span> <span class="op">&lt;-</span> <span class="va">atp_2018</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">winner_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nwin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nwin</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">win10</span></span>
<span><span class="co">#&gt; # A tibble: 93 × 2</span></span>
<span><span class="co">#&gt;   winner_name       nwin</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adrian Mannarino    26</span></span>
<span><span class="co">#&gt; 2 Albert Ramos        21</span></span>
<span><span class="co">#&gt; 3 Alex De Minaur      29</span></span>
<span><span class="co">#&gt; 4 Alexander Zverev    58</span></span>
<span><span class="co">#&gt; 5 Aljaz Bedene        19</span></span>
<span><span class="co">#&gt; 6 Andreas Seppi       24</span></span>
<span><span class="co">#&gt; # ℹ 87 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we apply <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code>, which takes the names of two data sets (the second is the one that contains information about how the first should be “filtered”). The third argument gives the name of the key (<code>winner_name</code>) in this case.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tennis_2019_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">win10</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tennis_2019_10</span><span class="op">$</span><span class="va">winner_name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This strategy only keeps the matches in 2019 where the <strong>winner</strong> had 10 or more match wins in 2018. It drops any matches where the <strong>loser</strong> lost against someone who did not have 10 or more match wins in 2018. So this isn’t yet perfect and would take a little more thought into which matches we actually want to keep for a particular analysis.</p>
</div>
</div>
</section><section id="filtering-with-anti_join" class="level3" data-number="11.3.2"><h3 data-number="11.3.2" class="anchored" data-anchor-id="filtering-with-anti_join">
<span class="header-section-number">11.3.2</span> Filtering with <code>anti_join()</code>
</h3>
<p>Now suppose that we want to only keep the matches in 2019 where the winning player did not have <strong>any</strong> wins in 2018. We might think of these players as “emerging players” in 2019, players who are coming back from an injury, etc.. To do this, we can use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>, which only keeps the rows in the first data set that do <strong>not</strong> have a match in the second data set.</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_winners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">atp_2019</span>, <span class="va">atp_2018</span>,</span>
<span>                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"winner_name"</span> <span class="op">=</span> <span class="st">"winner_name"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">new_winners</span><span class="op">$</span><span class="va">winner_name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then examine how many wins each of these “new” (or perhaps previously injured) players had in 2019:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_winners</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">winner_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nwin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">nwin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 59 × 2</span></span>
<span><span class="co">#&gt;   winner_name           nwin</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Christian Garin         32</span></span>
<span><span class="co">#&gt; 2 Juan Ignacio Londero    22</span></span>
<span><span class="co">#&gt; 3 Miomir Kecmanovic       22</span></span>
<span><span class="co">#&gt; 4 Hugo Dellien            12</span></span>
<span><span class="co">#&gt; 5 Attila Balazs            7</span></span>
<span><span class="co">#&gt; 6 Cedrik Marcel Stebe      7</span></span>
<span><span class="co">#&gt; # ℹ 53 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The filtering join functions are useful if you want to filter out observations by some criterion in a different data set.</p>
<p><strong>Exercise 3</strong>. Examine the following data sets (the first is <code>df1</code> and the second is <code>df2</code>) and then, without running any code, answer the following questions.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">xvar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="even">
<td style="text-align: center;">E</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">F</td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">yvar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">C</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">D</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">E</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">G</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">H</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol type="a">
<li><p>How many rows would be in the data set from <code>left_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>left_join(df2, df1, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>full_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>inner_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>semi_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>anti_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
</ol></section></section><section id="practice" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="practice">
<span class="header-section-number">11.4</span> Practice</h2>
<section id="class-exercises" class="level3" data-number="11.4.1"><h3 data-number="11.4.1" class="anchored" data-anchor-id="class-exercises">
<span class="header-section-number">11.4.1</span> Class Exercises</h3>
<p><strong>Class Exercise 1</strong>. Why might <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> be a dangerous way to combine data? What must you be sure of about the way the data was collected in order to combine data in this way?</p>
<p><strong>Class Exercise 2</strong>. The key variable is very important for joining and is not always available in a “perfect” form. Recall the college majors data sets we have, called <code>slumajors_df</code>, which information on majors at SLU. Another data set, <code>collegemajors_df</code>, has different statistics on college majors nationwide. There’s lots of interesting variables in these data sets, but we’ll focus on the <code>Major</code> variable here. Read in and examine the two data sets with:</p>
<div class="cell" data-appendix="true">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">slumajors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/SLU_Majors_17_21.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">collegemajors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/college-majors.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">slumajors_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   Major                        nfemales nmales</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                           &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Anthropology                       35     13</span></span>
<span><span class="co">#&gt; 2 Art &amp; Art History                  62     11</span></span>
<span><span class="co">#&gt; 3 Biochemistry                       15      6</span></span>
<span><span class="co">#&gt; 4 Biology                           152     58</span></span>
<span><span class="co">#&gt; 5 Business in the Liberal Arts      192    301</span></span>
<span><span class="co">#&gt; 6 Chemistry                          28     20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">collegemajors_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 12</span></span>
<span><span class="co">#&gt;   Major         Total   Men Women Major_category Employed Full_time Part_time</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 PETROLEUM EN…  2339  2057   282 Engineering        1976      1849       270</span></span>
<span><span class="co">#&gt; 2 MINING AND M…   756   679    77 Engineering         640       556       170</span></span>
<span><span class="co">#&gt; 3 METALLURGICA…   856   725   131 Engineering         648       558       133</span></span>
<span><span class="co">#&gt; 4 NAVAL ARCHIT…  1258  1123   135 Engineering         758      1069       150</span></span>
<span><span class="co">#&gt; 5 CHEMICAL ENG… 32260 21239 11021 Engineering       25694     23170      5180</span></span>
<span><span class="co">#&gt; 6 NUCLEAR ENGI…  2573  2200   373 Engineering        1857      2038       264</span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: Unemployed &lt;dbl&gt;, Median &lt;dbl&gt;, P25th &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   P75th &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li><p>Attempt to join the two data sets together with a key.</p></li>
<li><p>Why did the <code>collegemajors_df</code> give only <code>NA</code> values when we tried to join by major?</p></li>
</ol>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This example underscores the importance of having a key that matches <strong>exactly</strong>. Some, but not all, of the issues involved in joining these two data sets can be solved with functions in the <code>stringr</code> package (discussed in a few weeks). But, the underlying problem remains and, if we wanted to combine the two data sets fully, we would need to recode some of the major names by hand.</p>
</div>
</div>
<p><strong>Class Exercise 3</strong>. Read in the gun violence data set, and suppose that you want to add a row to this data set that has the statistics on gun ownership and mortality rate in the District of Columbia (Washington D.C., which is in the NE region, has 16.7 deaths per 100,000 people, and a gun ownership rate of 8.7%). To do so, create a <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> that has a single row representing D.C. and then combine your new <code>tibble</code> with the overall gun violence data set. Name this new data set <code>all_df</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">mortality_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/gun_violence_us.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Class Exercise 4</strong>. Examine the following data sets that are in <code>R</code>’s base library on demographic statistics about the U.S. states and state abbreviations:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">state.x77</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">state.abb</span><span class="op">)</span></span>
<span><span class="va">df1</span></span>
<span><span class="co">#&gt; # A tibble: 50 × 8</span></span>
<span><span class="co">#&gt;   Population Income Illiteracy `Life Exp` Murder `HS Grad` Frost   Area</span></span>
<span><span class="co">#&gt;        &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1       3615   3624        2.1       69.0   15.1      41.3    20  50708</span></span>
<span><span class="co">#&gt; 2        365   6315        1.5       69.3   11.3      66.7   152 566432</span></span>
<span><span class="co">#&gt; 3       2212   4530        1.8       70.6    7.8      58.1    15 113417</span></span>
<span><span class="co">#&gt; 4       2110   3378        1.9       70.7   10.1      39.9    65  51945</span></span>
<span><span class="co">#&gt; 5      21198   5114        1.1       71.7   10.3      62.6    20 156361</span></span>
<span><span class="co">#&gt; 6       2541   4884        0.7       72.1    6.8      63.9   166 103766</span></span>
<span><span class="co">#&gt; # ℹ 44 more rows</span></span>
<span><span class="va">df2</span></span>
<span><span class="co">#&gt; # A tibble: 50 × 1</span></span>
<span><span class="co">#&gt;   value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 AL   </span></span>
<span><span class="co">#&gt; 2 AK   </span></span>
<span><span class="co">#&gt; 3 AZ   </span></span>
<span><span class="co">#&gt; 4 AR   </span></span>
<span><span class="co">#&gt; 5 CA   </span></span>
<span><span class="co">#&gt; 6 CO   </span></span>
<span><span class="co">#&gt; # ℹ 44 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine the two data sets with <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> and name the new data set <code>states_df</code>. What are you assuming about the data sets in order to use this function?</p>
<p><strong>Class Exercise 5</strong>. Use a join function to combine the mortality data set <strong>with</strong> D.C. (which we named <code>all_df</code>) with the states data set from the previous exercise (<code>states_df</code>). For this exercise, keep the row with Washington D.C., having it take on <code>NA</code> values for any variable not observed in the states data.</p>
<p><strong>Class Exercise 6</strong>. Repeat the previous exercise, but now drop Washington D.C. in your merging process. Practice doing this <strong>with a join function</strong> (as opposed to <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>-ing it out explicitly).</p>
<p><strong>Class Exercise 7</strong>. Use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> to create a subset of <code>states_df</code> that are in the <code>NE</code> region. <strong>Hint</strong>: You will need to filter <code>all_df</code> from Exercise 1 first to contain only states in the <code>NE</code> region.</p>
<p><strong>Class Exercise 8</strong>. Do the same thing as in the previous exercise (that is, create a subset of <code>states_df</code> that are in the <code>NE</code> region), but this time, use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>.</p>
</section><section id="your-turn" class="level3" data-number="11.4.2"><h3 data-number="11.4.2" class="anchored" data-anchor-id="your-turn">
<span class="header-section-number">11.4.2</span> Your Turn</h3>
<p><strong>Your Turn 1</strong>. In your group, evaluate whether each of the following statements are true or false:</p>
<ol type="a">
<li><p>An <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> will always result in a data set with the same or fewer rows than a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>.</p></li>
<li><p>An <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> will always result in a data set with the same or fewer rows than a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>.</p></li>
<li><p>A <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> will always result in a data set with the same number of rows as a <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> on the same two data sets.</p></li>
</ol>
<p><strong>Your Turn 2</strong>. Examine the following data sets (the first is <code>df3</code> and the second is <code>df4</code>) and then, without running any code, answer the following questions in your group. Keep in mind that there are some duplicate keys!</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">xvar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">A</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="even">
<td style="text-align: center;">C</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">F</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">F</td>
<td style="text-align: center;">6</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">yvar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">D</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">D</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">D</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol type="a">
<li><p>How many rows would be in the data set from <code>left_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>left_join(df2, df1, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>full_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>inner_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>semi_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
<li><p>How many rows would be in the data set from <code>anti_join(df1, df2, by = c("id" = "id"))</code>?</p></li>
</ol>
<p><strong>Your Turn 3</strong>. Examine again the gun violence data set, and explain why each attempt at combining the D.C. data with the overall data doesn’t work or is incorrect.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="fl">16.7</span>,</span>
<span>                ownership_rate <span class="op">=</span> <span class="fl">8.7</span>, region <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">test1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="fl">16.7</span>,</span>
<span>       ownership_rate <span class="op">=</span> <span class="fl">0.087</span>, region <span class="op">=</span> <span class="va">NE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval_tidy(xs[[j]], mask): object 'NE' not found</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">test2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in list2(...): object 'test2' not found</span></span>
<span></span>
<span><span class="va">test3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Washington D.C."</span>, mortality_rate <span class="op">=</span> <span class="st">"16.7"</span>,</span>
<span>       ownership_rate <span class="op">=</span> <span class="st">"0.087"</span>, region <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">mortality_df</span>, <span class="va">test3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `bind_rows()`:</span></span>
<span><span class="co">#&gt; ! Can't combine `..1$mortality_rate` &lt;double&gt; and `..2$mortality_rate` &lt;character&gt;.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./08-import.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Import</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-lubridate.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Dates with <code>lubridate</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Course Materials were written by Matt Higham for STAT/DATA 234 at St.&nbsp;Lawrence University.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>